<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>report.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}@import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:300italic,400italic,700italic,400,300,700);.haroopad{padding:20px;color:#222;font-size:15px;font-family:"Roboto Condensed",Tauri,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.haroopad a{color:#3269a0}.haroopad a:hover{color:#4183c4}.haroopad h2{border-bottom:1px solid #e6e6e6}.haroopad h6{color:#777}.haroopad hr{border:1px solid #e6e6e6}.haroopad blockquote>code,.haroopad h1>code,.haroopad h2>code,.haroopad h3>code,.haroopad h4>code,.haroopad h5>code,.haroopad h6>code,.haroopad li>code,.haroopad p>code,.haroopad td>code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;background-color:rgba(0,0,0,.02);padding:.2em .5em;border:1px solid #efefef}.haroopad pre>code{font-size:1em;letter-spacing:-1px;font-weight:700}.haroopad blockquote{border-left:4px solid #e6e6e6;padding:0 15px;color:#777}.haroopad table{background-color:#fafafa}.haroopad table tr td,.haroopad table tr th{border:1px solid #e6e6e6}.haroopad table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fff;color:#000;-webkit-text-size-adjust:none}.apache .hljs-cbracket,.diff .hljs-header,.hljs-annotation,.hljs-chunk,.hljs-comment{color:green}.bash .hljs-variable,.css .smalltalk .hljs-class,.hljs-built_in,.hljs-id,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.nginx .hljs-title,.tex .hljs-command,.xml .hljs-tag,.xml .hljs-tag .hljs-value{color:#00f}.apache .hljs-tag,.coffeescript .hljs-attribute,.django .hljs-variable,.hljs-addition,.hljs-date,.hljs-flow,.hljs-parent,.hljs-rules .hljs-value,.hljs-stream,.hljs-string,.hljs-tag .hljs-value,.hljs-template_tag,.hljs-title,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.tex .hljs-formula{color:#a31515}.apache .hljs-sqbracket,.hljs-array,.hljs-attr_selector,.hljs-decorator,.hljs-deletion,.hljs-doctype,.hljs-envvar,.hljs-filter .hljs-argument,.hljs-localvars,.hljs-pi,.hljs-pragma,.hljs-preprocessor,.hljs-prompt,.hljs-pseudo,.hljs-shebang,.nginx .hljs-built_in,.ruby .hljs-string,.tex .hljs-special,.userType{color:#2b91af}.hljs-dartdoc,.hljs-javadoc,.hljs-phpdoc,.hljs-xmlDocTag{color:gray}.hljs-type,.hljs-typename{font-weight:700}.vhdl .hljs-string{color:#666}.vhdl .hljs-literal{color:#a31515}.vhdl .hljs-attribute{color:#00b0e8}.xml .hljs-attribute{color:red}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:2px;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:2px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:1em}.MathJax_MenuRadioCheck.RTL{right:1em;left:auto}.MathJax_MenuLabel{padding:2px 2em 4px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #CCC;margin:4px 1px 0}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:Highlight;color:HighlightText}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}.MathJax_Display{text-align:center;margin:1em 0;position:relative;display:block!important;text-indent:0;max-width:none;max-height:none;min-width:0;min-height:0;width:100%}.MathJax .merror{background-color:#FF8;color:#C00;border:1px solid #C00;padding:1px 3px;font-style:normal;font-size:90%}.MathJax .MJX-monospace{font-family:monospace}.MathJax .MJX-sans-serif{font-family:sans-serif}#MathJax_Tooltip{background-color:InfoBackground;color:InfoText;border:1px solid #000;box-shadow:2px 2px 5px #AAA;-webkit-box-shadow:2px 2px 5px #AAA;-moz-box-shadow:2px 2px 5px #AAA;-khtml-box-shadow:2px 2px 5px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true');padding:3px 4px;z-index:401;position:absolute;left:0;top:0;width:auto;height:auto;display:none}.MathJax{display:inline;font-style:normal;font-weight:400;line-height:normal;font-size:100%;font-size-adjust:none;text-indent:0;text-align:left;text-transform:none;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0;min-height:0;border:0;padding:0;margin:0}.MathJax a,.MathJax img,.MathJax nobr{border:0;padding:0;margin:0;max-width:5000em;max-height:5000em;min-width:0;min-height:0;vertical-align:0;line-height:normal;text-decoration:none}img.MathJax_strut{border:0!important;padding:0!important;margin:0!important;vertical-align:0!important}.MathJax span{display:inline;position:static;border:0;padding:0;margin:0;vertical-align:0;line-height:normal;text-decoration:none}.MathJax nobr{white-space:nowrap!important}.MathJax img{display:inline!important;float:none!important}.MathJax *{transition:none;-webkit-transition:none;-moz-transition:none;-ms-transition:none;-o-transition:none}.MathJax_Processing{visibility:hidden;position:fixed;width:0;height:0;overflow:hidden}.MathJax_Processed{display:none!important}.MathJax_ExBox{display:block!important;overflow:hidden;width:1px;height:60ex;min-height:0;max-height:none}.MathJax .MathJax_EmBox{display:block!important;overflow:hidden;width:1px;height:60em;min-height:0;max-height:none}.MathJax .MathJax_HitBox{cursor:text;background:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_Tooltip *,.MathJax .MathJax_HitBox *{filter:none;opacity:1;background:0 0}@font-face{font-family:MathJax_Main;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?rev=2.4-beta-2) format('opentype')}@font-face{font-family:MathJax_Main;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?rev=2.4-beta-2) format('opentype');font-weight:700}@font-face{font-family:MathJax_Main;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?rev=2.4-beta-2) format('opentype');font-style:italic}@font-face{font-family:MathJax_Math;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?rev=2.4-beta-2) format('opentype');font-style:italic}@font-face{font-family:MathJax_Caligraphic;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?rev=2.4-beta-2) format('opentype')}@font-face{font-family:MathJax_Size1;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?rev=2.4-beta-2) format('opentype')}@font-face{font-family:MathJax_Size2;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?rev=2.4-beta-2) format('opentype')}@font-face{font-family:MathJax_Size3;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?rev=2.4-beta-2) format('opentype')}@font-face{font-family:MathJax_Size4;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?rev=2.4-beta-2) format('opentype')}.MathJax .noError{font-size:90%;text-align:left;color:#000;padding:1px 3px;border:1px solid}@font-face{font-family:MathJax_AMS;src:url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?rev=2.4-beta-2) format('woff'),url(file:///F:/Haroopad/Libraries/.js/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?rev=2.4-beta-2) format('opentype')}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown haroopad">
<h2 id="计算机图形学——单人fps游戏"><a name="计算机图形学——单人fps游戏" href="#计算机图形学——单人fps游戏"></a>计算机图形学——单人FPS游戏</h2><p><strong>组员：</strong><br><strong>蒋仕彪——3170102587</strong><br><strong>刘明锐——3170105696</strong><br><strong>罗炜程——3170105902</strong><br><strong>王宇晗——3170106051</strong><br><strong>提交日期：2019-06-24</strong></p><h2 id="一、概述"><a name="一、概述" href="#一、概述"></a>一、概述</h2><p>本次我们的图形学大作业做的是一个基于OpenGL的单人FPS游戏，实现了以下几点要求</p><ul>
<li>基本要求<ul>
<li>体素表达<ul>
<li>中间的球、圆柱、圆锥</li></ul>
</li><li>obj的导入<ul>
<li>静态位置（星球）</li><li>实时位置（手榴弹瞄准）</li><li>动态位置（子弹的飞行）</li></ul>
</li><li>纹理<ul>
<li>制造（中间的体素）</li><li>贴图（天空盒）</li></ul>
</li><li>几何变换<ul>
<li>南瓜与人距离越近的时候，越会面向人走过来</li></ul>
</li><li>光照<ul>
<li>点光源</li><li>动态变化</li></ul>
</li><li>漫游<ul>
<li>按鼠标和WASD进行移动</li><li>空格进行跳跃</li><li>回车复活</li></ul>
</li><li>动画和截屏<ul>
<li>胜利后升天的动画</li><li>按 P 截屏</li></ul>
</li></ul>
</li><li>高级要求<ul>
<li>实时检测的碰撞系统<ul>
<li>子弹碰到墙面反射</li><li>子弹碰到图形反射</li><li>人碰到墙/图形被阻挡</li><li>人打破墙会越过墙。</li></ul>
</li><li>阴影<ul>
<li>实时阴影检测</li></ul>
</li><li>游戏性<ul>
<li>显示剩余南瓜数量</li><li>胜利时打出 you win 并有升天效果</li><li>可以按回车复活</li></ul>
</li><li>对象表达能力（）<ul>
<li>墙的破坏（右键）</li><li>人遇到墙会阻挡</li><li>跳过墙或穿过墙</li><li>墙的内外贴图</li><li>子弹遇到墙的反弹</li></ul>
</li></ul>
</li><li>一些小特色<ul>
<li>跳跃和重力系统<ul>
<li>空格键跳跃，回车键复活</li><li>可以跳着过墙</li></ul>
</li><li>打中南瓜后，南瓜会变红一会</li><li>子弹多次打中南瓜，南瓜会消失</li></ul>
</li></ul><h2 id="二、技术要点"><a name="二、技术要点" href="#二、技术要点"></a>二、技术要点</h2><h4 id="1.-基本体素的表达与绘制流程"><a name="1.-基本体素的表达与绘制流程" href="#1.-基本体素的表达与绘制流程"></a>1. 基本体素的表达与绘制流程</h4><ul>
<li>除了墙本身使用立方体建模之外，游戏中还实现了圆、圆柱和圆锥三种基本体素，放置在场景中心。</li><li><p>体素表达</p>
<ul>
<li><p>圆</p>
<ul>
<li>表达的本质是将图形拆成三角形面来表示，分配好点坐标、法向量和贴图坐标后传输给绘制模块。</li><li>如图所示，通过在经度和维度方向上间隔一定角度采样，按照图中的方式将点相连就可以得到三角形。</li><li>贴图时，将图中割出的方形小块贴上一个正方形贴图即可。</li></ul>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/drawsphere.jpg" alt="" title="markdown" style="width:800px"></p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  const int sphereprec = 15;
  const double PI = acos(-1);
  void generatesphere(vector&amp;lt;pair&amp;lt;pair&amp;lt;Point3D, Point3D&amp;gt;, Point2D&amp;gt;&amp;gt; &amp;amp;vec) {
      Point3D tmp[sphereprec + 1][sphereprec];
      for (int i = 0; i &amp;lt;= sphereprec; ++i) {
          double the = PI * i / sphereprec - PI / 2;
          for (int j = 0; j &amp;lt; sphereprec; ++j) {
              double alp = 2 * PI * j / sphereprec;
              tmp[i][j] = Point3D(cos(the)*cos(alp), sin(the), cos(the)*sin(alp));
              if (i == 0 || i == sphereprec) tmp[i][j].x = tmp[i][j].z = 0;
          }
      }
      for (int i = 1; i &amp;lt; sphereprec; ++i) {
          for (int j = 0; j &amp;lt; sphereprec; ++j) {
              int k = (j + 1) % sphereprec;

  #define vebp(i,j,x,y) vec.emplace_back(make_pair(make_pair(tmp[i][j],tmp[i][j]),Point2D(x,y)))
          vebp(i, k, 1, 1); vebp(i, j, 0, 1); vebp(i - 1, j, 0, 0);
          vebp(i, j, 0, 0); vebp(i, k, 1, 0); vebp(i + 1, k, 1, 1);
          }
      }
  }
</code></pre>">  <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> sphereprec = <span class="hljs-number">15</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> PI = <span class="hljs-built_in">acos</span>(-<span class="hljs-number">1</span>);
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generatesphere</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;pair&lt;pair&lt;Point3D, Point3D&gt;, Point2D&gt;&gt; &amp;vec)</span> </span>{
      Point3D tmp[sphereprec + <span class="hljs-number">1</span>][sphereprec];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= sphereprec; ++i) {
          <span class="hljs-keyword">double</span> the = PI * i / sphereprec - PI / <span class="hljs-number">2</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; sphereprec; ++j) {
              <span class="hljs-keyword">double</span> alp = <span class="hljs-number">2</span> * PI * j / sphereprec;
              tmp[i][j] = Point3D(<span class="hljs-built_in">cos</span>(the)*<span class="hljs-built_in">cos</span>(alp), <span class="hljs-built_in">sin</span>(the), <span class="hljs-built_in">cos</span>(the)*<span class="hljs-built_in">sin</span>(alp));
              <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> || i == sphereprec) tmp[i][j].x = tmp[i][j].z = <span class="hljs-number">0</span>;
          }
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; sphereprec; ++i) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; sphereprec; ++j) {
              <span class="hljs-keyword">int</span> k = (j + <span class="hljs-number">1</span>) % sphereprec;

  <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> vebp(i,j,x,y) vec.emplace_back(make_pair(make_pair(tmp[i][j],tmp[i][j]),Point2D(x,y)))</span>
          vebp(i, k, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>); vebp(i, j, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>); vebp(i - <span class="hljs-number">1</span>, j, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
          vebp(i, j, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); vebp(i, k, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>); vebp(i + <span class="hljs-number">1</span>, k, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          }
      }
  }
</code></pre>
</li><li>圆柱<ul>
<li>类似于圆，圆柱只需要将 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-18-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-218" style="width: 0.683em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.546em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.853em 1000em 2.828em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-219"><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.923em; vertical-align: -0.317em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-18">y</script></span> 方向（经度方向）上的圆弧变化变为不变的定值即可。注意最上侧和最下侧要强制设定为点，以保证是闭合图形。<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>for (int i = 0; i &amp;lt;= sphereprec; ++i) {
  double hei = 2. * i / sphereprec - 1.;
  for (int j = 0; j &amp;lt; sphereprec; ++j) {
      double alp = 2 * PI * j / sphereprec;
      tmp[i][j] = Point3D(cos(alp), hei, sin(alp));
      if (i == 0 || i == sphereprec) tmp[i][j].x = tmp[i][j].z = 0;
  }
}
</code></pre>"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= sphereprec; ++i) {
  <span class="hljs-keyword">double</span> hei = <span class="hljs-number">2.</span> * i / sphereprec - <span class="hljs-number">1.</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; sphereprec; ++j) {
      <span class="hljs-keyword">double</span> alp = <span class="hljs-number">2</span> * PI * j / sphereprec;
      tmp[i][j] = Point3D(<span class="hljs-built_in">cos</span>(alp), hei, <span class="hljs-built_in">sin</span>(alp));
      <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> || i == sphereprec) tmp[i][j].x = tmp[i][j].z = <span class="hljs-number">0</span>;
  }
}
</code></pre>
</li></ul>
</li><li><p>圆锥</p>
<ul>
<li>同样地，圆锥只要将 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-19-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-221" style="width: 0.683em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.546em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.853em 1000em 2.828em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-222"><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.923em; vertical-align: -0.317em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-19">y</script></span> 方向（经度方向）上的变化改为线性变化即可，最下侧需要保证为点。</li></ul>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  for (int i = 0; i &amp;lt;= sphereprec; ++i) {
      double hei = 2. * i / sphereprec - 1., rad = 1 - 1. * (i + 1) / sphereprec;
      for (int j = 0; j &amp;lt; sphereprec; ++j) {
          double alp = 2 * PI * j / sphereprec;
          tmp[i][j] = Point3D(rad * cos(alp), hei, rad * sin(alp));
          if (i == 0 || i == sphereprec) tmp[i][j].x = tmp[i][j].z = 0;
      }
  }
</code></pre>">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= sphereprec; ++i) {
      <span class="hljs-keyword">double</span> hei = <span class="hljs-number">2.</span> * i / sphereprec - <span class="hljs-number">1.</span>, rad = <span class="hljs-number">1</span> - <span class="hljs-number">1.</span> * (i + <span class="hljs-number">1</span>) / sphereprec;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; sphereprec; ++j) {
          <span class="hljs-keyword">double</span> alp = <span class="hljs-number">2</span> * PI * j / sphereprec;
          tmp[i][j] = Point3D(rad * <span class="hljs-built_in">cos</span>(alp), hei, rad * <span class="hljs-built_in">sin</span>(alp));
          <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> || i == sphereprec) tmp[i][j].x = tmp[i][j].z = <span class="hljs-number">0</span>;
      }
  }
</code></pre>
</li></ul>
</li><li><p>体素绘制</p>
<ul>
<li>计算出三角形的位置之后，只需要和上述其他绘制一样，整理成对应格式即可。</li><li><p>对于贴图，我们选择了自己绘制的黄红相间和黄绿相间的两种贴图。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  void renderTriangle(unsigned int &amp;amp;triVAO, unsigned int &amp;amp;triVBO, vector&amp;lt;pair&amp;lt;pair&amp;lt;Point3D, Point3D&amp;gt;, Point2D&amp;gt;&amp;gt; &amp;amp;vec)
  {
  float *vertices = new float [vec.size() * DATASIZE];
  for (int i = 0; i &amp;lt; vec.size(); i++)
      vec[i].first.first.PushPoint(vec[i].first.second, vertices + DATASIZE * i, vec[i].second);

  if (triVAO == 0)
  {
      glGenVertexArrays(1, &amp;amp;triVAO);
      glGenBuffers(1, &amp;amp;triVBO);
      // fill buffer
      glBindBuffer(GL_ARRAY_BUFFER, triVBO);
      glBufferData(GL_ARRAY_BUFFER, vec.size() * DATASIZE * sizeof(float), vertices, GL_STATIC_DRAW);
      // link vertex attributes
      glBindVertexArray(triVAO);
      glEnableVertexAttribArray(0);
      glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)0);
      glEnableVertexAttribArray(1);
      glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(3 * sizeof(float)));
      glEnableVertexAttribArray(2);
      glVertexAttribPointer(2, 2, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(6 * sizeof(float)));
      glBindBuffer(GL_ARRAY_BUFFER, 0);
      glBindVertexArray(0);
  }

  glBindBuffer(GL_ARRAY_BUFFER, triVBO);
  glBufferData(GL_ARRAY_BUFFER, vec.size() * DATASIZE * sizeof(float), vertices, GL_STATIC_DRAW);

  glBindVertexArray(triVAO);
  glDrawArrays(GL_TRIANGLES, 0, vec.size());
  glBindVertexArray(0);

  delete[] vertices;
}
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">renderTriangle</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;triVAO, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;triVBO, <span class="hljs-built_in">vector</span>&lt;pair&lt;pair&lt;Point3D, Point3D&gt;, Point2D&gt;&gt; &amp;vec)</span>
  </span>{
  <span class="hljs-keyword">float</span> *vertices = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span> [vec.size() * DATASIZE];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vec.size(); i++)
      vec[i].first.first.PushPoint(vec[i].first.second, vertices + DATASIZE * i, vec[i].second);

  <span class="hljs-keyword">if</span> (triVAO == <span class="hljs-number">0</span>)
  {
      glGenVertexArrays(<span class="hljs-number">1</span>, &amp;triVAO);
      glGenBuffers(<span class="hljs-number">1</span>, &amp;triVBO);
      <span class="hljs-comment">// fill buffer</span>
      glBindBuffer(GL_ARRAY_BUFFER, triVBO);
      glBufferData(GL_ARRAY_BUFFER, vec.size() * DATASIZE * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), vertices, GL_STATIC_DRAW);
      <span class="hljs-comment">// link vertex attributes</span>
      glBindVertexArray(triVAO);
      glEnableVertexAttribArray(<span class="hljs-number">0</span>);
      glVertexAttribPointer(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)<span class="hljs-number">0</span>);
      glEnableVertexAttribArray(<span class="hljs-number">1</span>);
      glVertexAttribPointer(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)(<span class="hljs-number">3</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>)));
      glEnableVertexAttribArray(<span class="hljs-number">2</span>);
      glVertexAttribPointer(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)(<span class="hljs-number">6</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>)));
      glBindBuffer(GL_ARRAY_BUFFER, <span class="hljs-number">0</span>);
      glBindVertexArray(<span class="hljs-number">0</span>);
  }

  glBindBuffer(GL_ARRAY_BUFFER, triVBO);
  glBufferData(GL_ARRAY_BUFFER, vec.size() * DATASIZE * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), vertices, GL_STATIC_DRAW);

  glBindVertexArray(triVAO);
  glDrawArrays(GL_TRIANGLES, <span class="hljs-number">0</span>, vec.size());
  glBindVertexArray(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">delete</span>[] vertices;
}
</code></pre>
</li></ul>
</li><li><p>最终效果</p>
<ul>
<li><p>我们最终选择在地图中心放置这三个体素，按o键切换贴图。</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/sphere.png" alt="" title="markdown" style="width:500px"></p>
</li></ul>
</li></ul><h4 id="2.-obj的导入绘制与封装流程"><a name="2.-obj的导入绘制与封装流程" href="#2.-obj的导入绘制与封装流程"></a>2. OBJ的导入绘制与封装流程</h4><ul>
<li><p>概况和环境配置</p>
<ul>
<li>导入 <code>obj</code> 的时候，我们用到一个非常流行的模型导入库是 <code>Assimp库</code>，它是 Open Asset Import Library（开放的资产导入库）的缩写。</li><li>当使用 <code>Assimp</code> 导入一个模型的时候，它通常会将整个模型加载进一个场景对象<code>Scene</code>。</li><li>一个模型一般分为 <code>.obj</code> 和 <code>.mtl</code> 两个文件（当然还包括一些必要的图片文件）。<code>.obj</code> 用来描述顶点和面，而 <code>.mtl</code> 是纹理配置文件。</li><li>我们需要做的第一件事是将一个物体加载到 <code>Scene</code> 对象中，遍历节点，获取对应的 <code>Mesh</code>对象（我们需要递归搜索每个节点的子节点），并处理每个 <code>Mesh</code> 对象来获取顶点数据、索引以及它的材质属性。最终的结果是一系列的网格数据，我们会将它们包含在一个 <code>Model</code> 对象中。</li><li>一个很重要的类别是网格类 <code>Mesh</code>，它的定义如下：</li><li><pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;> class Mesh {
      public:
          vector&amp;lt;Vertex&amp;gt; vertices;
          vector&amp;lt;unsigned int&amp;gt; indices;
          vector&amp;lt;Texture&amp;gt; textures;
          Mesh(vector&amp;lt;Vertex&amp;gt; vertices, vector&amp;lt;unsigned int&amp;gt; indices, vector&amp;lt;Texture&amp;gt; textures);
          void Draw(Shader shader);
      private:
          unsigned int VAO, VBO, EBO;
          void setupMesh();
  };
</code></pre>"> <span class="hljs-keyword">class</span> Mesh {
      <span class="hljs-keyword">public</span>:
          <span class="hljs-built_in">vector</span>&lt;Vertex&gt; vertices;
          <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>&gt; indices;
          <span class="hljs-built_in">vector</span>&lt;Texture&gt; textures;
          Mesh(<span class="hljs-built_in">vector</span>&lt;Vertex&gt; vertices, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>&gt; indices, <span class="hljs-built_in">vector</span>&lt;Texture&gt; textures);
          <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span><span class="hljs-params">(Shader shader)</span></span>;
      <span class="hljs-keyword">private</span>:
          <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> VAO, VBO, EBO;
          <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setupMesh</span><span class="hljs-params">()</span></span>;
  };
</code></pre>
</li><li>就像顶点缓冲数组和顶点索引数组一样，<code>Mesh</code> 类里也有顶点数组、索引数组，以及贴图的位置信息。</li></ul>
</li><li><p>模型的封装</p>
<ul>
<li>为了更好地封装模型，我们再引入一个 <code>model</code> 类。<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  class Model{
      public:
          Model(char *path){
              loadModel(path);
          }
          void Draw(Shader shader);
      private:
          vector&amp;lt;Mesh&amp;gt; meshes;
          string directory;
          void loadModel(string path);
          void processNode(aiNode *node, const aiScene *scene);
          Mesh processMesh(aiMesh *mesh, const aiScene *scene);
          vector&amp;lt;Texture&amp;gt; loadMaterialTextures(aiMaterial *mat, aiTextureType type, string typeName);
  };
</code></pre>">  <span class="hljs-keyword">class</span> Model{
      <span class="hljs-keyword">public</span>:
          Model(<span class="hljs-keyword">char</span> *path){
              loadModel(path);
          }
          <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span><span class="hljs-params">(Shader shader)</span></span>;
      <span class="hljs-keyword">private</span>:
          <span class="hljs-built_in">vector</span>&lt;Mesh&gt; meshes;
          <span class="hljs-built_in">string</span> directory;
          <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loadModel</span><span class="hljs-params">(<span class="hljs-built_in">string</span> path)</span></span>;
          <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">processNode</span><span class="hljs-params">(aiNode *node, <span class="hljs-keyword">const</span> aiScene *scene)</span></span>;
          <span class="hljs-function">Mesh <span class="hljs-title">processMesh</span><span class="hljs-params">(aiMesh *mesh, <span class="hljs-keyword">const</span> aiScene *scene)</span></span>;
          <span class="hljs-built_in">vector</span>&lt;Texture&gt; loadMaterialTextures(aiMaterial *mat, aiTextureType type, <span class="hljs-built_in">string</span> typeName);
  };
</code></pre>
</li><li>我们预期的对外接口是：用<code>loadModel()</code> 来初始化模型（从路径中导入），用 <code>Draw()</code> 来绘制模型。外层会在给出的 <code>Shader</code> 里定义模型的旋转量、摆放位置以及缩放程度。</li></ul>
</li><li><p>模型的使用和继承</p>
<ul>
<li>在官网下载 <code>assimp</code> 后，用 <code>cmake</code> 生成 <code>lib</code>，并加入以下代码。<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  #include &amp;lt;assimp/Importer.hpp&amp;gt;
  #include &amp;lt;assimp/scene.h&amp;gt;
  #include &amp;lt;assimp/postprocess.h&amp;gt;
</code></pre>">  <span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;assimp/Importer.hpp&gt;</span>
  <span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;assimp/scene.h&gt;</span>
  <span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;assimp/postprocess.h&gt;</span>
</code></pre>
</li><li>为了更好地管理模型，我们在 <code>model.cpp</code> 里建立一个 <code>vector&lt;Model *&gt;</code>，用来管理所有模型。新建时，只需 new 一个新的 <code>model</code> 类并给出模型地址。</li><li><p>导入月球后效果如图：</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/planet.png" alt="" title="markdown" style="width:500px"></p>
</li><li><p>现在考虑如何管理模型。可以在 <code>model</code> 类里增加一些 <code>vec3</code> 变量，表示模型目前的位置，模型的朝向等。绘制模型时如一下代码：</p>
<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>void drawModel(const Shader &amp;amp;shader) {
  for (auto it : ModelManager) {
      it-&amp;gt;sethit();
      if (it-&amp;gt;typ != 0 &amp;amp;&amp;amp; it-&amp;gt;Checkhitpoint() == false) continue;
      glm::mat4 model = glm::mat4(1.0f);
      model = glm::translate(model, glm::vec3((it-&amp;gt;pos).x, (it-&amp;gt;pos).y, (it-&amp;gt;pos).z));
      Point3D origin = Point3D(0, 0, 1);
      double theta = (it-&amp;gt;Front % origin) / (it-&amp;gt;Front).length();
      Point3D axis = (it-&amp;gt;Front) * origin;
      if (sgn(axis.length()) != 0)
          model = glm::rotate(model, (float)(-acos(theta)), glm::vec3(axis.x, axis.y, axis.z));
      model = glm::scale(model, glm::vec3(it-&amp;gt;size, it-&amp;gt;size, it-&amp;gt;size));
      shader.setMat4(&quot;model&quot;, model);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawModel</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Shader &amp;shader)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it : ModelManager) {
      it-&gt;sethit();
      <span class="hljs-keyword">if</span> (it-&gt;typ != <span class="hljs-number">0</span> &amp;&amp; it-&gt;Checkhitpoint() == <span class="hljs-keyword">false</span>) <span class="hljs-keyword">continue</span>;
      glm::mat4 model = glm::mat4(<span class="hljs-number">1.0f</span>);
      model = glm::translate(model, glm::vec3((it-&gt;pos).x, (it-&gt;pos).y, (it-&gt;pos).z));
      Point3D origin = Point3D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
      <span class="hljs-keyword">double</span> theta = (it-&gt;Front % origin) / (it-&gt;Front).length();
      Point3D axis = (it-&gt;Front) * origin;
      <span class="hljs-keyword">if</span> (sgn(axis.length()) != <span class="hljs-number">0</span>)
          model = glm::rotate(model, (<span class="hljs-keyword">float</span>)(-<span class="hljs-built_in">acos</span>(theta)), glm::vec3(axis.x, axis.y, axis.z));
      model = glm::scale(model, glm::vec3(it-&gt;size, it-&gt;size, it-&gt;size));
      shader.setMat4(<span class="hljs-string">"model"</span>, model);
}
</code></pre>
</li><li>其中 <code>it-&gt;Front</code> 表示南瓜应该朝向的方向（在后面会有详细介绍），<code>it-&gt;size</code> 表示模型缩放大小，<code>it-&gt;pos</code> 表示模型当前位置。这里涉及到的点积和叉积，是为了将南瓜从默认朝向调整为我们想要的朝向。</li><li>但是，不同的模型可能还需要各种不同的功能，例如：<ul>
<li>子弹模型需要对物体做反弹和射入的判定</li><li>南瓜需要进行血量判定</li><li>手榴弹需要实时判定（当用户视线中心在墙面上就显示）</li></ul>
</li><li>为了更好地管理 <code>model</code> 类，我们还从 <code>model</code> 中派生出一些子类，并用动态绑定技术，用统一的基类指针管理。</li></ul>
</li></ul><h4 id="3.-纹理贴图的实现方法"><a name="3.-纹理贴图的实现方法" href="#3.-纹理贴图的实现方法"></a>3. 纹理贴图的实现方法</h4><ul>
<li><p>墙的贴图</p>
<ul>
<li>在最开始讨论的时候我们觉得，一块一块砖去渲染贴图效率会比较低。我们相用 <code>KDtree</code>（四分树）来加速这个过程。具体的，我们每次判断当前的长方形是否是完整的：<ul>
<li>如果是，直接绘制这个长方形（其实是两个三角形）并退出</li><li>将图形分裂成两部分或者四部分，并递归下去。</li></ul>
</li><li><strong>但这里遗留一个问题：在破坏部分砖块后，我们必须要能看到别的砖块里面的颜色。</strong>所以我们还是要<strong>针对每块砖</strong>去进行渲染，<code>KDtree</code> 也就失去了优化的意义。</li><li>所以我们最终采用的渲染方式是：先将墙拆成一个一个立方体吗，再进行贴图。我们先一个形式化地涂立方体的代码，每次用矩阵操作在 <code>shader</code> 里去限定它的位置和大小，再调用渲染函数。</li><li>即使采取暴力渲染的方式，墙的贴图也会比普通的立方体要难很多，因为每个单位的砖块只是调用了一小块的贴图。我们需要具体地计算每个砖块所在的坐标。而且对于垂直的墙和竖直的墙，绘制的面显然是不一样的。</li><li><p>综合以上的考量，绘制墙代码的函数变得比较笨重：</p>
<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  void renderCube(unsigned int &amp;amp;cubeVAO, unsigned int &amp;amp;cubeVBO, Point3D texture, bool type = 0)
  {
      static float vertices[] = {}；
      //注意这里省略了细节，本来是一个正方体的标准贴图
      if (cubeVAO == 0)
      {
          glGenVertexArrays(1, &amp;amp;cubeVAO);
          glGenBuffers(1, &amp;amp;cubeVBO);
          // fill buffer
          glBindBuffer(GL_ARRAY_BUFFER, cubeVBO);
          glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);
          // link vertex attributes
          glBindVertexArray(cubeVAO);
          glEnableVertexAttribArray(0);
          glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)0);
          glEnableVertexAttribArray(1);
          glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(3 * sizeof(float)));
          glEnableVertexAttribArray(2);
          glVertexAttribPointer(2, 2, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(6 * sizeof(float)));
          glBindBuffer(GL_ARRAY_BUFFER, 0);
          glBindVertexArray(0);
      }
      for (int st = 0; st &amp;lt; 6; st++) {
          vertices[st * 48 + 8 * 0 + 6] = vertices[st * 48 + 8 * 4 + 6] = vertices[st * 48 + 8 * 5 + 6] = 0.05;
          vertices[st * 48 + 8 * 0 + 7] = vertices[st * 48 + 8 * 1 + 7] = vertices[st * 48 + 8 * 5 + 7] = 0.05;
          vertices[st * 48 + 8 * 1 + 6] = vertices[st * 48 + 8 * 2 + 6] = vertices[st * 48 + 8 * 3 + 6] = 0.06;
          vertices[st * 48 + 8 * 2 + 7] = vertices[st * 48 + 8 * 3 + 7] = vertices[st * 48 + 8 * 4 + 7] = 0.06;
      }

      if (type == 0) {
          vertices[0 * 48 + 8 * 0 + 6] = vertices[0 * 48 + 8 * 4 + 6] = vertices[0 * 48 + 8 * 5 + 6] = texture.x;
          vertices[0 * 48 + 8 * 0 + 7] = vertices[0 * 48 + 8 * 2 + 7] = vertices[0 * 48 + 8 * 4 + 7] = texture.y;
          vertices[0 * 48 + 8 * 1 + 6] = vertices[0 * 48 + 8 * 2 + 6] = vertices[0 * 48 + 8 * 3 + 6] = texture.x + texture.z;
          vertices[0 * 48 + 8 * 1 + 7] = vertices[0 * 48 + 8 * 3 + 7] = vertices[0 * 48 + 8 * 5 + 7] = texture.y + texture.z;

          vertices[1 * 48 + 8 * 0 + 6] = vertices[1 * 48 + 8 * 4 + 6] = vertices[1 * 48 + 8 * 5 + 6] = texture.x;
          vertices[1 * 48 + 8 * 0 + 7] = vertices[1 * 48 + 8 * 1 + 7] = vertices[1 * 48 + 8 * 5 + 7] = texture.y;
          vertices[1 * 48 + 8 * 1 + 6] = vertices[1 * 48 + 8 * 2 + 6] = vertices[1 * 48 + 8 * 3 + 6] = texture.x + texture.z;
          vertices[1 * 48 + 8 * 2 + 7] = vertices[1 * 48 + 8 * 3 + 7] = vertices[1 * 48 + 8 * 4 + 7] = texture.y + texture.z;
      }
      else {
          vertices[2 * 48 + 8 * 1 + 6] = vertices[2 * 48 + 8 * 2 + 6] = vertices[2 * 48 + 8 * 3 + 6] = texture.x;
          vertices[2 * 48 + 8 * 2 + 7] = vertices[2 * 48 + 8 * 3 + 7] = vertices[2 * 48 + 8 * 4 + 7] = texture.y;
          vertices[2 * 48 + 8 * 0 + 6] = vertices[2 * 48 + 8 * 4 + 6] = vertices[2 * 48 + 8 * 5 + 6] = texture.x + texture.z;
          vertices[2 * 48 + 8 * 0 + 7] = vertices[2 * 48 + 8 * 1 + 7] = vertices[2 * 48 + 8 * 5 + 7] = texture.y + texture.z;

          vertices[3 * 48 + 8 * 0 + 6] = vertices[3 * 48 + 8 * 4 + 6] = vertices[3 * 48 + 8 * 5 + 6] = texture.x;
          vertices[3 * 48 + 8 * 1 + 7] = vertices[3 * 48 + 8 * 3 + 7] = vertices[3 * 48 + 8 * 5 + 7] = texture.y;
          vertices[3 * 48 + 8 * 1 + 6] = vertices[3 * 48 + 8 * 2 + 6] = vertices[3 * 48 + 8 * 3 + 6] = texture.x + texture.z;
          vertices[3 * 48 + 8 * 0 + 7] = vertices[3 * 48 + 8 * 2 + 7] = vertices[3 * 48 + 8 * 4 + 7] = texture.y + texture.z;
      }
      glBindBuffer(GL_ARRAY_BUFFER, cubeVBO);
      glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);

      glBindVertexArray(cubeVAO);
      glDrawArrays(GL_TRIANGLES, 0, 36);
      glBindVertexArray(0);
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">renderCube</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;cubeVAO, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;cubeVBO, Point3D texture, <span class="hljs-keyword">bool</span> type = 0)</span>
  </span>{
      <span class="hljs-keyword">static</span> <span class="hljs-keyword">float</span> vertices[] = {}；
      <span class="hljs-comment">//注意这里省略了细节，本来是一个正方体的标准贴图</span>
      <span class="hljs-keyword">if</span> (cubeVAO == <span class="hljs-number">0</span>)
      {
          glGenVertexArrays(<span class="hljs-number">1</span>, &amp;cubeVAO);
          glGenBuffers(<span class="hljs-number">1</span>, &amp;cubeVBO);
          <span class="hljs-comment">// fill buffer</span>
          glBindBuffer(GL_ARRAY_BUFFER, cubeVBO);
          glBufferData(GL_ARRAY_BUFFER, <span class="hljs-keyword">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);
          <span class="hljs-comment">// link vertex attributes</span>
          glBindVertexArray(cubeVAO);
          glEnableVertexAttribArray(<span class="hljs-number">0</span>);
          glVertexAttribPointer(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)<span class="hljs-number">0</span>);
          glEnableVertexAttribArray(<span class="hljs-number">1</span>);
          glVertexAttribPointer(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)(<span class="hljs-number">3</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>)));
          glEnableVertexAttribArray(<span class="hljs-number">2</span>);
          glVertexAttribPointer(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), (<span class="hljs-keyword">void</span>*)(<span class="hljs-number">6</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>)));
          glBindBuffer(GL_ARRAY_BUFFER, <span class="hljs-number">0</span>);
          glBindVertexArray(<span class="hljs-number">0</span>);
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> st = <span class="hljs-number">0</span>; st &lt; <span class="hljs-number">6</span>; st++) {
          vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">6</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">6</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">6</span>] = <span class="hljs-number">0.05</span>;
          vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">7</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">7</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">7</span>] = <span class="hljs-number">0.05</span>;
          vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">6</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">6</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">6</span>] = <span class="hljs-number">0.06</span>;
          vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">7</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">7</span>] = vertices[st * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">7</span>] = <span class="hljs-number">0.06</span>;
      }

      <span class="hljs-keyword">if</span> (type == <span class="hljs-number">0</span>) {
          vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">6</span>] = texture.x;
          vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">7</span>] = texture.y;
          vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">6</span>] = texture.x + texture.z;
          vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">0</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">7</span>] = texture.y + texture.z;

          vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">6</span>] = texture.x;
          vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">7</span>] = texture.y;
          vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">6</span>] = texture.x + texture.z;
          vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">1</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">7</span>] = texture.y + texture.z;
      }
      <span class="hljs-keyword">else</span> {
          vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">6</span>] = texture.x;
          vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">7</span>] = texture.y;
          vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">6</span>] = texture.x + texture.z;
          vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">2</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">7</span>] = texture.y + texture.z;

          vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">6</span>] = texture.x;
          vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">5</span> + <span class="hljs-number">7</span>] = texture.y;
          vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">1</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">6</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-number">6</span>] = texture.x + texture.z;
          vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">0</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">2</span> + <span class="hljs-number">7</span>] = vertices[<span class="hljs-number">3</span> * <span class="hljs-number">48</span> + <span class="hljs-number">8</span> * <span class="hljs-number">4</span> + <span class="hljs-number">7</span>] = texture.y + texture.z;
      }
      glBindBuffer(GL_ARRAY_BUFFER, cubeVBO);
      glBufferData(GL_ARRAY_BUFFER, <span class="hljs-keyword">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);

      glBindVertexArray(cubeVAO);
      glDrawArrays(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">36</span>);
      glBindVertexArray(<span class="hljs-number">0</span>);
  }
</code></pre>
</li></ul>
</li><li><p>天空盒：</p>
<ul>
<li><p>绘制一个较大的立方体对象，使其将整个场景包含在内。然后对其使用立方体贴图：</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  unsigned int loadCubemap(std::vector&amp;lt;std::string&amp;gt; faces){
  unsigned int textureID;
  glGenTextures(1, &amp;amp;textureID);
  glBindTexture(GL_TEXTURE_CUBE_MAP, textureID);
  int width, height, nrChannels;
  for (unsigned int i = 0; i &amp;lt; faces.size(); i++)
  {
      unsigned char *data = stbi_load(faces[i].c_str(), &amp;amp;width, &amp;amp;height, &amp;amp;nrChannels, 0);
      if (data)
      {
          glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i,
              0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data
          );
          stbi_image_free(data);
      }
      else
      {
          std::cout &amp;lt;&amp;lt; &quot;Cubemap texture failed to load at path: &quot; &amp;lt;&amp;lt; faces[i] &amp;lt;&amp;lt; std::endl;
          stbi_image_free(data);
      }
  }
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);
  return textureID;
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadCubemap</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; faces)</span></span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> textureID;
  glGenTextures(<span class="hljs-number">1</span>, &amp;textureID);
  glBindTexture(GL_TEXTURE_CUBE_MAP, textureID);
  <span class="hljs-keyword">int</span> width, height, nrChannels;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; faces.size(); i++)
  {
      <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *data = stbi_load(faces[i].c_str(), &amp;width, &amp;height, &amp;nrChannels, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">if</span> (data)
      {
          glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i,
              <span class="hljs-number">0</span>, GL_RGB, width, height, <span class="hljs-number">0</span>, GL_RGB, GL_UNSIGNED_BYTE, data
          );
          stbi_image_free(data);
      }
      <span class="hljs-keyword">else</span>
      {
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Cubemap texture failed to load at path: "</span> &lt;&lt; faces[i] &lt;&lt; <span class="hljs-built_in">std</span>::endl;
          stbi_image_free(data);
      }
  }
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
  glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);
  <span class="hljs-keyword">return</span> textureID;
  }
</code></pre>
</li></ul>
<ul>
<li><p>由于随着位置的移动，天空盒的立方体与你的相对距离并不会改变（即天空与你的距离并不会随着你的移动而缩短），天空盒的观察矩阵应不存在深度变化。设置矩阵时，齐次坐标向量的最后一维固定为0：</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>    view = glm::mat4(glm::mat3(camera.GetViewMatrix()));
</code></pre>">    view = glm::mat4(glm::mat3(camera.GetViewMatrix()));
</code></pre>
</li><li><p>最后天空盒的效果如图：</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/skybox1.png" alt="" title="markdown" style="width:800px"><br><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/skybox2.png" alt="" title="markdown" style="width:800px"></p>
</li></ul>
</li></ul><h4 id="4.-导入物体的移动与旋转"><a name="4.-导入物体的移动与旋转" href="#4.-导入物体的移动与旋转"></a>4. 导入物体的移动与旋转</h4><ul>
<li><p>南瓜怪的基本设定</p>
<ul>
<li><p>南瓜的基本信息包括：</p>
<ul>
<li>世界系坐标<code>Position</code></li><li>血量<code>hitpoint</code></li><li>被击中时间<code>hittime</code></li></ul>
</li><li><p>我们的场景中南瓜不会翻转，因此只需要描述出南瓜的<strong>朝向</strong>，就可以完成南瓜的绘制。因此我们对每个南瓜维护三个方向向量<code>Front</code>, <code>Left</code> 和<code>Up</code>，他们满足右手系，只要确定了<code>Front</code>就可以确定剩下两个向量：</p>
<ul>
<li><span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-20-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-224" style="width: 12.817em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.492em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.228em 1000em 3.092em -0.49em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-225"><span class="munderover" id="MathJax-Span-226"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(1.59em 1000em 2.828em -0.46em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-227"><span class="mi" id="MathJax-Span-228" style="font-family: MathJax_Math; font-style: italic;">L</span><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-230" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.001em;"><span class="mo" id="MathJax-Span-232" style=""><span style="display: inline-block; position: relative; width: 2.074em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.13em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.304em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.717em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-233" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-234" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="mn" id="MathJax-Span-235" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-236" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-237" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-239" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-240" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-241" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="munderover" id="MathJax-Span-242" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 2.678em; height: 0px;"><span style="position: absolute; clip: rect(1.615em 1000em 2.634em -0.461em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-243"><span class="mi" id="MathJax-Span-244" style="font-family: MathJax_Math; font-style: italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.106em;"></span></span><span class="mi" id="MathJax-Span-245" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-246" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-247" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-248" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.428em; left: 0.001em;"><span class="mo" id="MathJax-Span-249" style=""><span style="display: inline-block; position: relative; width: 2.675em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.731em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.351em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.811em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.271em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.835em; vertical-align: -0.372em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-20">\overrightarrow{Left}=(0,1,0)\times\overrightarrow{Front}</script></span></li><li><p><span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-21-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-250" style="width: 10.617em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.689em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.228em 1000em 3.047em -0.492em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-251"><span class="munderover" id="MathJax-Span-252"><span style="display: inline-block; position: relative; width: 1.392em; height: 0px;"><span style="position: absolute; clip: rect(1.612em 1000em 2.817em -0.432em); top: -2.459em; left: 0.041em;"><span class="mrow" id="MathJax-Span-253"><span class="mi" id="MathJax-Span-254" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span><span class="mi" id="MathJax-Span-255" style="font-family: MathJax_Math; font-style: italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.431em; left: 0em;"><span class="mo" id="MathJax-Span-256" style=""><span style="display: inline-block; position: relative; width: 1.392em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 0.448em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-257" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-258" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 2.678em; height: 0px;"><span style="position: absolute; clip: rect(1.615em 1000em 2.634em -0.461em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-259"><span class="mi" id="MathJax-Span-260" style="font-family: MathJax_Math; font-style: italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.106em;"></span></span><span class="mi" id="MathJax-Span-261" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-263" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-264" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.428em; left: 0.001em;"><span class="mo" id="MathJax-Span-265" style=""><span style="display: inline-block; position: relative; width: 2.675em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.731em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.351em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.811em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.271em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-266" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="munderover" id="MathJax-Span-267" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(1.59em 1000em 2.828em -0.46em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-268"><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math; font-style: italic;">L</span><span class="mi" id="MathJax-Span-270" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-271" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-272" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.001em;"><span class="mo" id="MathJax-Span-273" style=""><span style="display: inline-block; position: relative; width: 2.074em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.13em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.304em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.717em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.78em; vertical-align: -0.317em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-21">\overrightarrow{Up}=\overrightarrow{Front}\times\overrightarrow{Left}</script></span></p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/fkwyh2.bmp" alt="" title="markdown" style="width:800px"></p>
</li></ul>
</li></ul>
</li><li><p>南瓜怪的行为</p>
<ul>
<li><p>我们给南瓜幽灵设计了移动函数，来实现符合以下性质的场景内追逐</p>
<ol>
<li>移动连续，移动方向较少发生突变</li><li>移动具有随机性<ul>
<li>在远离玩家时，做类似于无规则的漫游</li><li>在接近玩家时，会直接冲向玩家</li></ul>
</li></ol>
</li><li><p>为此我们设定在每一帧，南瓜有<code>1%</code>的概率改变朝向，在改变朝向时有<span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-22-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-274" style="width: 1.683em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.366em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.124em 1000em 2.761em -0.492em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-275"><span class="mfrac" id="MathJax-Span-276"><span style="display: inline-block; position: relative; width: 1.104em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.716em 1000em 2.529em -0.462em); top: -2.778em; left: 50%; margin-left: -0.191em;"><span class="mn" id="MathJax-Span-277" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 2.35em;"></span></span><span style="position: absolute; clip: rect(1.64em 1000em 2.467em -0.468em); top: -1.892em; left: 50%; margin-left: -0.492em;"><span class="mrow" id="MathJax-Span-278"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-280" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-281" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.295em;"></span></span><span style="position: absolute; clip: rect(0.861em 1000em 1.257em -0.492em); top: -1.313em; left: 0em;"><span style="border-left-width: 1.104em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.093em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.731em; vertical-align: -0.568em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-22">\frac{3}{dis}</script></span> 的概率转向玩家的方向，其中<code>dis</code> 为该南瓜与玩家的距离。这样在场景中南瓜本身改变方向的频率很小，但在距离较近时可以认为一定会转向玩家，使得南瓜更有幽灵的体验感。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  bool Trymove(Point3D goal, double movelen) {
      if (Checkhitpoint() == false) return false;
      if((goal - pos).length() &amp;lt;= 0.5) {
          return true;
      }
      else {
          goal.y = pos.y;
          // 1% probability
          double nowdis = (goal - pos).length();
          int trymodified = rand() % 100 &amp;lt;= 1;
          bool check = abs(pos.x) &amp;gt; bordersize || abs(pos.y) &amp;gt; bordersize;
          if (trymodified) {
              // 3/dis probability
              int go = rand() % max(1, (int)(goal - pos).length());
              if (go &amp;lt;= 3 || check)
                  Front = goal - pos;
              else
                  Front = Point3D(rand() % 101 - 50, 0, rand() % 101 - 50);
          }
          // pumpkin move
          pos = pos + Front.resize(movelen);
          // maintain coordinates
          Front = Front.resize(1);
          Point3D temp = Point3D(0, 1, 0) * Front;
          if (sgn(temp.length()) != 0)Left = temp;
          Left = Left.resize(1);

          Up = Front * Left;
          Up = Up.resize(1);
      }
      return false;
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Trymove</span><span class="hljs-params">(Point3D goal, <span class="hljs-keyword">double</span> movelen)</span> </span>{
      <span class="hljs-keyword">if</span> (Checkhitpoint() == <span class="hljs-keyword">false</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      <span class="hljs-keyword">if</span>((goal - pos).length() &lt;= <span class="hljs-number">0.5</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
      }
      <span class="hljs-keyword">else</span> {
          goal.y = pos.y;
          <span class="hljs-comment">// 1% probability</span>
          <span class="hljs-keyword">double</span> nowdis = (goal - pos).length();
          <span class="hljs-keyword">int</span> trymodified = rand() % <span class="hljs-number">100</span> &lt;= <span class="hljs-number">1</span>;
          <span class="hljs-keyword">bool</span> check = <span class="hljs-built_in">abs</span>(pos.x) &gt; bordersize || <span class="hljs-built_in">abs</span>(pos.y) &gt; bordersize;
          <span class="hljs-keyword">if</span> (trymodified) {
              <span class="hljs-comment">// 3/dis probability</span>
              <span class="hljs-keyword">int</span> go = rand() % max(<span class="hljs-number">1</span>, (<span class="hljs-keyword">int</span>)(goal - pos).length());
              <span class="hljs-keyword">if</span> (go &lt;= <span class="hljs-number">3</span> || check)
                  Front = goal - pos;
              <span class="hljs-keyword">else</span>
                  Front = Point3D(rand() % <span class="hljs-number">101</span> - <span class="hljs-number">50</span>, <span class="hljs-number">0</span>, rand() % <span class="hljs-number">101</span> - <span class="hljs-number">50</span>);
          }
          <span class="hljs-comment">// pumpkin move</span>
          pos = pos + Front.resize(movelen);
          <span class="hljs-comment">// maintain coordinates</span>
          Front = Front.resize(<span class="hljs-number">1</span>);
          Point3D temp = Point3D(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) * Front;
          <span class="hljs-keyword">if</span> (sgn(temp.length()) != <span class="hljs-number">0</span>)Left = temp;
          Left = Left.resize(<span class="hljs-number">1</span>);

          Up = Front * Left;
          Up = Up.resize(<span class="hljs-number">1</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
  }
</code></pre>
</li><li><p>子弹在场景中以直线运动；且碰墙会反弹，若一直没有碰到南瓜寿命为500帧；若碰到南瓜会使南瓜掉血并变红。与墙的碰撞在碰撞检测部分介绍。</p>
</li></ul>
</li></ul><h4 id="5.-光源实现方法"><a name="5.-光源实现方法" href="#5.-光源实现方法"></a>5. 光源实现方法</h4><ul>
<li><p>Phong光照模型</p>
<ul>
<li><p>理论基础</p>
<p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-111-Frame"><nobr><span class="math" id="MathJax-Span-3189" style="width: 15.883em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.005em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.228em 1000em 3.047em -0.49em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3190"><span class="munderover" id="MathJax-Span-3191"><span style="display: inline-block; position: relative; width: 3.388em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.454em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3192"><span class="mi" id="MathJax-Span-3193" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3194" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3195" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3196" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-3197" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3198" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3199" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3200" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3201" style=""><span style="display: inline-block; position: relative; width: 3.385em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.441em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.401em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.911em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.421em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.931em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3202" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-3203" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 3.497em; height: 0px;"><span style="position: absolute; clip: rect(1.59em 1000em 2.828em -0.437em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3204"><span class="mi" id="MathJax-Span-3205" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3206" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3207" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3208" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3209" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3210" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3211" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.002em;"><span class="mo" id="MathJax-Span-3212" style=""><span style="display: inline-block; position: relative; width: 3.494em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.55em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.423em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.955em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.487em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.018em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3213" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="munderover" id="MathJax-Span-3214" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.454em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3215"><span class="mi" id="MathJax-Span-3216" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3217" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3218" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3219" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-3220" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3221" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3222" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3223" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3224" style=""><span style="display: inline-block; position: relative; width: 3.549em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.605em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.434em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.977em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.519em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.062em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.78em; vertical-align: -0.317em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-111">\overrightarrow {lightdir}=\overrightarrow{fragpos}-\overrightarrow{lightpos}</script><p></p><p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-112-Frame"><nobr><span class="math" id="MathJax-Span-3225" style="width: 15.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.896em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.228em 1000em 3.047em -0.49em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3226"><span class="munderover" id="MathJax-Span-3227"><span style="display: inline-block; position: relative; width: 3.333em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3228"><span class="mi" id="MathJax-Span-3229" style="font-family: MathJax_Math; font-style: italic;">v</span><span class="mi" id="MathJax-Span-3230" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3231" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3232" style="font-family: MathJax_Math; font-style: italic;">w</span><span class="mi" id="MathJax-Span-3233" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3234" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3235" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3236" style=""><span style="display: inline-block; position: relative; width: 3.33em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.386em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.39em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.889em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.388em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.887em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3237" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-3238" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 3.497em; height: 0px;"><span style="position: absolute; clip: rect(1.59em 1000em 2.828em -0.437em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3239"><span class="mi" id="MathJax-Span-3240" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3241" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3242" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3243" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3244" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3245" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3246" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.002em;"><span class="mo" id="MathJax-Span-3247" style=""><span style="display: inline-block; position: relative; width: 3.494em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.55em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.423em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.955em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.487em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.018em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3248" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="munderover" id="MathJax-Span-3249" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.497em; height: 0px;"><span style="position: absolute; clip: rect(1.634em 1000em 2.817em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3250"><span class="mi" id="MathJax-Span-3251" style="font-family: MathJax_Math; font-style: italic;">v</span><span class="mi" id="MathJax-Span-3252" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3253" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3254" style="font-family: MathJax_Math; font-style: italic;">w</span><span class="mi" id="MathJax-Span-3255" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3256" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3257" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.409em; left: 0.002em;"><span class="mo" id="MathJax-Span-3258" style=""><span style="display: inline-block; position: relative; width: 3.494em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.55em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.423em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.955em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.487em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.018em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.78em; vertical-align: -0.317em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-112">\overrightarrow{viewdir}=\overrightarrow{fragpos}-\overrightarrow{viewpos}</script><p></p><p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-113-Frame"><nobr><span class="math" id="MathJax-Span-3259" style="width: 19.217em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.738em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.228em 1000em 3.047em -0.49em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3260"><span class="munderover" id="MathJax-Span-3261"><span style="display: inline-block; position: relative; width: 3.279em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3262"><span class="mi" id="MathJax-Span-3263" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3264" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3265" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3266" style="font-family: MathJax_Math; font-style: italic;">m</span><span class="mi" id="MathJax-Span-3267" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3268" style="font-family: MathJax_Math; font-style: italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3269" style=""><span style="display: inline-block; position: relative; width: 3.276em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.332em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.379em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.867em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.355em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.844em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3270" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-3271" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 4.973em; height: 0px;"><span style="position: absolute; clip: rect(1.809em 1000em 3.047em -0.437em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3272"><span class="mi" id="MathJax-Span-3273" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3274" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3275" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3276" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3277" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3278" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3279" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3280" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3281" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3282" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.001em;"><span class="mo" id="MathJax-Span-3283" style=""><span style="display: inline-block; position: relative; width: 4.97em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 4.026em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.408em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.925em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.442em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.958em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.475em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.992em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 3.509em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3284" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="munderover" id="MathJax-Span-3285" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.918em; height: 0px;"><span style="position: absolute; clip: rect(1.809em 1000em 3.047em -0.437em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3286"><span class="mi" id="MathJax-Span-3287" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3288" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3289" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3290" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3291" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3292" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3293" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3294" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3295" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3296" style="font-family: MathJax_Math; font-style: italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.453em; left: 0.001em;"><span class="mo" id="MathJax-Span-3297" style=""><span style="display: inline-block; position: relative; width: 4.915em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 3.971em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.401em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.911em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.421em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.931em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.441em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.951em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 3.461em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.78em; vertical-align: -0.317em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-113">\overrightarrow{normal}=\overrightarrow{fragedge\_a}\times \overrightarrow{fragedge\_ b}</script><p></p><p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-114-Frame"><nobr><span class="math" id="MathJax-Span-3298" style="width: 22.95em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.798em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.239em 1000em 3.092em -0.459em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3299"><span class="mi" id="MathJax-Span-3300" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3301" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3302" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3303" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3304" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3305" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3306" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3307" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3308" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3309" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3310" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3311" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3312" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3313" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-3314" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-3315" style="font-family: MathJax_Main; padding-left: 0.278em;">max</span><span class="mo" id="MathJax-Span-3316" style="font-family: MathJax_Main;">(</span><span class="munderover" id="MathJax-Span-3317"><span style="display: inline-block; position: relative; width: 3.388em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.454em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3318"><span class="mi" id="MathJax-Span-3319" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3320" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3321" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3322" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-3323" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3324" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3325" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3326" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3327" style=""><span style="display: inline-block; position: relative; width: 3.385em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.441em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.401em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.911em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.421em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.931em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3328" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="munderover" id="MathJax-Span-3329" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.279em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3330"><span class="mi" id="MathJax-Span-3331" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3332" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3333" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3334" style="font-family: MathJax_Math; font-style: italic;">m</span><span class="mi" id="MathJax-Span-3335" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3336" style="font-family: MathJax_Math; font-style: italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3337" style=""><span style="display: inline-block; position: relative; width: 3.276em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.332em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.379em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.867em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.355em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.844em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3338" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-3339" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-3340" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.822em; vertical-align: -0.372em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-114">diff\_ intensity=\max( \overrightarrow {lightdir}\cdot \overrightarrow{normal},0)</script><p></p><p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-115-Frame"><nobr><span class="math" id="MathJax-Span-3341" style="width: 29.35em; display: inline-block;"><span style="display: inline-block; position: relative; width: 24.044em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.239em 1000em 3.092em -0.439em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-3342"><span class="mi" id="MathJax-Span-3343" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3344" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3345" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3346" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-3347" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3348" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3349" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3350" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3351" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3352" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3353" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3354" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3355" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3356" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-3357" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-3358" style="font-family: MathJax_Main; padding-left: 0.278em;">max</span><span class="mo" id="MathJax-Span-3359" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-3360" style="font-family: MathJax_Main;">(</span><span class="munderover" id="MathJax-Span-3361"><span style="display: inline-block; position: relative; width: 3.388em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.454em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3362"><span class="mi" id="MathJax-Span-3363" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3364" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3365" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3366" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-3367" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3368" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3369" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3370" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3371" style=""><span style="display: inline-block; position: relative; width: 3.385em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.441em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.401em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.911em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.421em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.931em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3372" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="munderover" id="MathJax-Span-3373" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.333em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3374"><span class="mi" id="MathJax-Span-3375" style="font-family: MathJax_Math; font-style: italic;">v</span><span class="mi" id="MathJax-Span-3376" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3377" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3378" style="font-family: MathJax_Math; font-style: italic;">w</span><span class="mi" id="MathJax-Span-3379" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3380" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3381" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3382" style=""><span style="display: inline-block; position: relative; width: 3.33em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.386em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.39em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.889em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.388em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.887em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3383" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-3384" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="munderover" id="MathJax-Span-3385" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 3.279em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-3386"><span class="mi" id="MathJax-Span-3387" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3388" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3389" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-3390" style="font-family: MathJax_Math; font-style: italic;">m</span><span class="mi" id="MathJax-Span-3391" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3392" style="font-family: MathJax_Math; font-style: italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-3393" style=""><span style="display: inline-block; position: relative; width: 3.276em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 2.332em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.379em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.867em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.355em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.844em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-3394" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-3395" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-3396" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.822em; vertical-align: -0.372em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-115">spec\_ intensity=\max((\overrightarrow{lightdir}+\overrightarrow{viewdir})\cdot \overrightarrow{normal},0)</script><p></p><p><span class="MathJax_Preview"></span></p><div class="MathJax_Display" role="textbox" aria-readonly="true"><span class="MathJax" id="MathJax-Element-116-Frame"><nobr><span class="math" id="MathJax-Span-3397" style="width: 100%; display: inline-block; min-width: 38.883em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(3.075em 1000em 5.733em -0.458em); top: -3.989em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-3398"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(3.075em 1000em 4.403em -0.458em); top: -3.989em; left: 50%; margin-left: -15.941em;"><span class="mi" id="MathJax-Span-3399" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-3400" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3401" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3402" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3403" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mo" id="MathJax-Span-3404" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-3405" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">a</span><span class="mi" id="MathJax-Span-3406" style="font-family: MathJax_Math; font-style: italic;">m</span><span class="mi" id="MathJax-Span-3407" style="font-family: MathJax_Math; font-style: italic;">b</span><span class="mi" id="MathJax-Span-3408" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3409" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3410" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3411" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-3412" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-3413" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-3414" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3415" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3416" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3417" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3418" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mi" id="MathJax-Span-3419" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3420" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mo" id="MathJax-Span-3421" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-3422" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3423" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3424" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3425" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mi" id="MathJax-Span-3426" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3427" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3428" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3429" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3430" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3431" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3432" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3433" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3434" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3435" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-3436" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-3437" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">s</span><span class="mi" id="MathJax-Span-3438" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3439" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3440" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-3441" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mi" id="MathJax-Span-3442" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3443" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-3444" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mo" id="MathJax-Span-3445" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-3446" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">s</span><span class="mi" id="MathJax-Span-3447" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-3448" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3449" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-3450" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-3451" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3452" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3453" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3454" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-3455" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-3456" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-3457" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3458" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3459" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-3460" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; clip: rect(3.131em 1000em 4.358em -0.414em); top: -2.615em; left: 50%; margin-left: -2.356em;"><span class="mo" id="MathJax-Span-3461" style="font-family: MathJax_Main;">⋅</span><span class="mi" id="MathJax-Span-3462" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">l</span><span class="mi" id="MathJax-Span-3463" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-3464" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-3465" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-3466" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-3467" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-3468" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3469" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-3470" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-3471" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.975em; vertical-align: -1.994em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-116">color=ambient+(diffuse\cdot diff\_ intensity+specular\cdot spec\_ intensity)\cdot lightcolor</script><p></p></li><li><p>计算出物体表面各片元的颜色值。所得到的物体表面显示效果不仅有随角度而定的明暗效果，还有一定的镜面高光。</p>
</li><li><p>随着观察者位置和光源位置的移动，物体的明暗效果也会随之动态变化。</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/lyc0.png" alt="" title="markdown" style="width:800px"></p>
</li></ul>
</li><li><p>具体计算方式与实现：</p>
<ul>
<li>由于使用了Phong而非Gouraud光照模型，在顶点着色器中只需要传送顶点与其法向数据。在片段着色器中，对于每一个面，使用三个顶点的光照向量进行插值，再代入上述公式中依次计算。</li><li>需要注意的是，在计算漫反射与镜面反射强度时，如果两个向量成钝角将会得到负数点积。此时如果直接将其代入计算会得到与事实不符的结果。实际上这个强度最小应该是0 。</li><li>对于面数较少的简单几何体，可以把法向量直接输入到顶点信息中。这样能够减少片段着色器的计算。</li></ul>
</li></ul><h4 id="6.-场景漫游与人物移动的实现"><a name="6.-场景漫游与人物移动的实现" href="#6.-场景漫游与人物移动的实现"></a>6. 场景漫游与人物移动的实现</h4><ul>
<li><p>基本场景漫游的实现</p>
<ul>
<li><p>为了简化建模，我们将游戏设计为第一人称游戏。因此人物移动和场景漫游所需要维护的方向向量就是在改变<code>camera</code>的视角等信息。因此以下的内容都被设计在<code>camera</code>类中。</p>
</li><li><p>场景漫游通过维护一个观察者坐标系来实现，<code>camera</code>的<strong>左手系坐标系</strong>不能仅由一个<code>front</code>来确定，简单来说同样是向前看，歪头后看到的场景也是不同的， 这和viewport非常类似。为了简化模型，我们约定观察者坐标系的<code>Right</code>必须与世界坐标系中的地平面平行，这可以通过将<code>front</code>与世界坐标系的<code>up</code>叉乘以实现：</p>
<ul>
<li><span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-45-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-498" style="width: 14.55em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.913em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.239em 1000em 3.047em -0.49em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-499"><span class="munderover" id="MathJax-Span-500"><span style="display: inline-block; position: relative; width: 2.568em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.459em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Math; font-style: italic;">R</span><span class="mi" id="MathJax-Span-503" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-505" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-506" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-507" style=""><span style="display: inline-block; position: relative; width: 2.565em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.621em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.324em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.756em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.189em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-508" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-509" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 2.678em; height: 0px;"><span style="position: absolute; clip: rect(1.615em 1000em 2.634em -0.461em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-510"><span class="mi" id="MathJax-Span-511" style="font-family: MathJax_Math; font-style: italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.106em;"></span></span><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-513" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-514" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-515" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.428em; left: 0.001em;"><span class="mo" id="MathJax-Span-516" style=""><span style="display: inline-block; position: relative; width: 2.675em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.731em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.351em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.811em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.271em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-517" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="munderover" id="MathJax-Span-518" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.098em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.817em -0.441em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-519"><span class="mi" id="MathJax-Span-520" style="font-family: MathJax_Math; font-style: italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.104em;"></span></span><span class="mi" id="MathJax-Span-521" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-523" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-524" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-525" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span><span class="mi" id="MathJax-Span-526" style="font-family: MathJax_Math; font-style: italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-527" style=""><span style="display: inline-block; position: relative; width: 4.095em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 3.151em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.434em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.978em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.521em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.065em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 2.608em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.767em; vertical-align: -0.317em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-45">\overrightarrow{Right}=\overrightarrow{Front}\times\overrightarrow{WorldUp}</script></span> </li><li><span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-46-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-528" style="width: 11.217em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.18em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.239em 1000em 3.047em -0.492em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-529"><span class="munderover" id="MathJax-Span-530"><span style="display: inline-block; position: relative; width: 1.392em; height: 0px;"><span style="position: absolute; clip: rect(1.612em 1000em 2.817em -0.432em); top: -2.459em; left: 0.041em;"><span class="mrow" id="MathJax-Span-531"><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span><span class="mi" id="MathJax-Span-533" style="font-family: MathJax_Math; font-style: italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.431em; left: 0em;"><span class="mo" id="MathJax-Span-534" style=""><span style="display: inline-block; position: relative; width: 1.392em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 0.448em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-535" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-536" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 2.568em; height: 0px;"><span style="position: absolute; clip: rect(1.601em 1000em 2.828em -0.459em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-537"><span class="mi" id="MathJax-Span-538" style="font-family: MathJax_Math; font-style: italic;">R</span><span class="mi" id="MathJax-Span-539" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-540" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-541" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.442em; left: 0.001em;"><span class="mo" id="MathJax-Span-543" style=""><span style="display: inline-block; position: relative; width: 2.565em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.621em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.324em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.756em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.189em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-544" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="munderover" id="MathJax-Span-545" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 2.678em; height: 0px;"><span style="position: absolute; clip: rect(1.615em 1000em 2.634em -0.461em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-546"><span class="mi" id="MathJax-Span-547" style="font-family: MathJax_Math; font-style: italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.106em;"></span></span><span class="mi" id="MathJax-Span-548" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-550" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-551" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(2.003em 1000em 2.853em -0.492em); top: -3.428em; left: 0.001em;"><span class="mo" id="MathJax-Span-552" style=""><span style="display: inline-block; position: relative; width: 2.675em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.989em; left: 1.731em;">→<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.351em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 0.811em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.989em; left: 1.271em;">−<span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.767em; vertical-align: -0.317em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-46">\overrightarrow{Up}=\overrightarrow{Right}\times\overrightarrow{Front}</script></span></li></ul>
</li><li><p>漫游的功能通过鼠标的动加以实现，视角的变化被描述为方向向量在球坐标系上的旋转。我们将该逻辑描述在函数<code>ProcessMouseEvent</code>中</p>
<ul>
<li>上下移动是<code>front</code>向量绕<code>x(-right)</code>轴旋转；</li><li>左右移动是<code>front</code>向量绕<code>y(up)</code>轴旋转。</li></ul>
</li><li><p>这些可以描述为球坐标系中角度的变化：</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/fuckwyh.jpg" alt="" title="markdown" style="width:600px"></p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>void ProcessMouseMovement(float xoffset, float yoffset, GLboolean constrainPitch = true)
{
  xoffset *= MouseSensitivity;
  yoffset *= MouseSensitivity;

  Yaw += xoffset;
  Pitch += yoffset;

  // Make sure that when pitch is out of bounds, screen doesn't get flipped
  if (constrainPitch)
  {
      if (Pitch &amp;gt; 89.0f)
          Pitch = 89.0f;
      if (Pitch &amp;lt; -89.0f)
          Pitch = -89.0f;
  }

  // Update Front, Right and Up Vectors using the updated Euler angles
  updateCameraVectors();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ProcessMouseMovement</span><span class="hljs-params">(<span class="hljs-keyword">float</span> xoffset, <span class="hljs-keyword">float</span> yoffset, GLboolean constrainPitch = <span class="hljs-keyword">true</span>)</span>
</span>{
  xoffset *= MouseSensitivity;
  yoffset *= MouseSensitivity;

  Yaw += xoffset;
  Pitch += yoffset;

  <span class="hljs-comment">// Make sure that when pitch is out of bounds, screen doesn't get flipped</span>
  <span class="hljs-keyword">if</span> (constrainPitch)
  {
      <span class="hljs-keyword">if</span> (Pitch &gt; <span class="hljs-number">89.0f</span>)
          Pitch = <span class="hljs-number">89.0f</span>;
      <span class="hljs-keyword">if</span> (Pitch &lt; -<span class="hljs-number">89.0f</span>)
          Pitch = -<span class="hljs-number">89.0f</span>;
  }

  <span class="hljs-comment">// Update Front, Right and Up Vectors using the updated Euler angles</span>
  updateCameraVectors();
}
</code></pre>
</li></ul>
<ul>
<li><p>将漫游附加在观察者坐标系中就构成了正确的玩家坐标系：</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>void updateCameraVectors()
{
  // Calculate the new Front vector
  glm::vec3 front;
  front.x = cos(glm::radians(Yaw)) * cos(glm::radians(Pitch));
  front.y = sin(glm::radians(Pitch));
  front.z = sin(glm::radians(Yaw)) * cos(glm::radians(Pitch));
  // to bring up accuracy
  Front = glm::normalize(front);
  // Also re-calculate the Right and Up vector
  Right = glm::normalize(glm::cross(Front, WorldUp));  // Normalize the vectors, because their length gets closer to 0 the more you look up or down which results in slower movement.
  Up = glm::normalize(glm::cross(Right, Front));
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateCameraVectors</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// Calculate the new Front vector</span>
  glm::vec3 front;
  front.x = <span class="hljs-built_in">cos</span>(glm::radians(Yaw)) * <span class="hljs-built_in">cos</span>(glm::radians(Pitch));
  front.y = <span class="hljs-built_in">sin</span>(glm::radians(Pitch));
  front.z = <span class="hljs-built_in">sin</span>(glm::radians(Yaw)) * <span class="hljs-built_in">cos</span>(glm::radians(Pitch));
  <span class="hljs-comment">// to bring up accuracy</span>
  Front = glm::normalize(front);
  <span class="hljs-comment">// Also re-calculate the Right and Up vector</span>
  Right = glm::normalize(glm::cross(Front, WorldUp));  <span class="hljs-comment">// Normalize the vectors, because their length gets closer to 0 the more you look up or down which results in slower movement.</span>
  Up = glm::normalize(glm::cross(Right, Front));
}
</code></pre>
</li></ul>
</li><li><p>人物行为</p>
<ul>
<li><p>人物移动服从物理规律。在地面上时，玩家可以：</p>
<ul>
<li>使用<code>WASD</code>在地面前后左右移动</li><li>使用<code>SPACE</code>跳跃</li><li>在跳跃时不可以改变移动方向<ul>
<li>即跳跃过程中的行为完全由跳起时的初速度决定</li></ul>
</li></ul>
</li><li><p>为了实现这一逻辑，我们给人物再维护一个速度向量<code>velocity</code>和一个加速度，人物移动通过两个函数来完成：</p>
<ul>
<li><code>ProcessKeyBoard</code>实现人物在地面上时的前后左右移动，<code>WASD</code>只能调整<code>x</code>和<code>z</code>坐标，而<code>SPACE</code>会给速度向量添加<code>y</code>分量的初值；</li></ul>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>if (Position.y &amp;lt;= 0)
{
  //Point3D(Position).debug();
  Position[1] = 0;
  velocity[1] = 0;
  glm::vec3 vFront, vRight;
  vFront = glm::vec3(Front[0], 0, Front[2]);
  vRight = glm::vec3(Right[0], 0, Right[2]);
  normalize(vFront); normalize(vRight);
  if (direction == FORWARD)
      velocity = vFront;
  else if (direction == BACKWARD)
      velocity = -vFront;
  else if (direction == RIGHT)
      velocity = vRight;
  else if (direction == LEFT)
      velocity = -vRight;
  else if (direction == JUMP)
      velocity[1] = 1.4;
  Position += velocity * k;

  pair&amp;lt;bool, Point3D&amp;gt; ret = CheckValiPosi(last);
  if (ret.first == false) 
      Position = last;
}
</code></pre>"><span class="hljs-keyword">if</span> (Position.y &lt;= <span class="hljs-number">0</span>)
{
  <span class="hljs-comment">//Point3D(Position).debug();</span>
  Position[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
  velocity[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
  glm::vec3 vFront, vRight;
  vFront = glm::vec3(Front[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>, Front[<span class="hljs-number">2</span>]);
  vRight = glm::vec3(Right[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>, Right[<span class="hljs-number">2</span>]);
  normalize(vFront); normalize(vRight);
  <span class="hljs-keyword">if</span> (direction == FORWARD)
      velocity = vFront;
  <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(direction == BACKWARD)</span>
      velocity </span>= -vFront;
  <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(direction == RIGHT)</span>
      velocity </span>= vRight;
  <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(direction == LEFT)</span>
      velocity </span>= -vRight;
  <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(direction == JUMP)</span>
      velocity[1] </span>= <span class="hljs-number">1.4</span>;
  Position += velocity * k;

  pair&lt;<span class="hljs-keyword">bool</span>, Point3D&gt; ret = CheckValiPosi(last);
  <span class="hljs-keyword">if</span> (ret.first == <span class="hljs-keyword">false</span>) 
      Position = last;
}
</code></pre>
</li><li><p><code>fall</code>在每一帧都会尝试进行，如果在地面上则无效，如果在空中则会先根据加速度和时间调整<code>velocity</code>,再根据速度调整人物的位置。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  if (Position[1] &amp;lt;= 0)
  {
      Position[1] = 0;
      velocity = glm::vec3(0, 0, 0);
  }
  else
  {
      //Point3D(Position).debug();
      velocity[1] -= g * k;
      Position += k * velocity;
      pair&amp;lt;bool, Point3D&amp;gt; ret = CheckValiPosi(last);
      if (ret.first == false)
      {
          if (sgn((ret.second - Point3D(0, 0, 0)).length())&amp;gt;0)
          {
              Point3D newv = subsao(Point3D(velocity), ret.second);
              bool fg = Position.y &amp;lt;= -0.2;
              velocity.x = newv.x;
              velocity.y = newv.y;
              velocity.z = newv.z;
              Position += k * velocity;
              if (fg)velocity = glm::vec3(0);
          }
          else
          {
              Position = last;
          }
      }
  }
</code></pre>">  <span class="hljs-keyword">if</span> (Position[<span class="hljs-number">1</span>] &lt;= <span class="hljs-number">0</span>)
  {
      Position[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
      velocity = glm::vec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  }
  <span class="hljs-keyword">else</span>
  {
      <span class="hljs-comment">//Point3D(Position).debug();</span>
      velocity[<span class="hljs-number">1</span>] -= g * k;
      Position += k * velocity;
      pair&lt;<span class="hljs-keyword">bool</span>, Point3D&gt; ret = CheckValiPosi(last);
      <span class="hljs-keyword">if</span> (ret.first == <span class="hljs-keyword">false</span>)
      {
          <span class="hljs-keyword">if</span> (sgn((ret.second - Point3D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)).length())&gt;<span class="hljs-number">0</span>)
          {
              Point3D newv = subsao(Point3D(velocity), ret.second);
              <span class="hljs-keyword">bool</span> fg = Position.y &lt;= -<span class="hljs-number">0.2</span>;
              velocity.x = newv.x;
              velocity.y = newv.y;
              velocity.z = newv.z;
              Position += k * velocity;
              <span class="hljs-keyword">if</span> (fg)velocity = glm::vec3(<span class="hljs-number">0</span>);
          }
          <span class="hljs-keyword">else</span>
          {
              Position = last;
          }
      }
  }
</code></pre>
</li></ul>
<ul>
<li><code>checkValiPosi</code>是实现碰撞检测的函数，将在<strong>场景实时碰撞检测实现方法</strong>着重介绍。</li></ul>
</li></ul><h4 id="7.-屏幕截图与加载文字"><a name="7.-屏幕截图与加载文字" href="#7.-屏幕截图与加载文字"></a>7. 屏幕截图与加载文字</h4><ul>
<li><p>截图的主要功能函数</p>
<ul>
<li><code>openGL</code> 提供强大的函数 <code>glReadPixels(0, 0, width, height, GL_RGB, GL_UNSIGNED_BYTE, screenData);</code> 分别表示截取的四个顶点位置，图片的色彩格式，保存数据的类型，保存到的数组首地址。</li></ul>
</li><li><p>截图函数的实现</p>
<ul>
<li>在 <code>screenshort.h</code> 里要提供一个对外接口 <code>screeshot(width, height)</code>，接受屏幕大小，并将结果储存到一个指定的文件里。</li><li><p>如果要保存到一个 <code>bmp</code> 文件里，还要有一点简单的图像信息处理的知识。在输出 <code>bmp</code> 前我们要指定它的头。例如：</p>
<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  BITMAPFILEHEADER bitmapFileHeader;
  memset(&amp;amp;bitmapFileHeader, 0, sizeof(BITMAPFILEHEADER));
  bitmapFileHeader.bfSize = sizeof(BITMAPFILEHEADER);
  bitmapFileHeader.bfType = 0x4d42;    //BM
  bitmapFileHeader.bfOffBits = sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER);

  //填充BITMAPINFOHEADER
  BITMAPINFOHEADER bitmapInfoHeader;
  memset(&amp;amp;bitmapInfoHeader, 0, sizeof(BITMAPINFOHEADER));
  bitmapInfoHeader.biSize = sizeof(BITMAPINFOHEADER);
  bitmapInfoHeader.biWidth = width;
  bitmapInfoHeader.biHeight = height;
  bitmapInfoHeader.biPlanes = 1;
  bitmapInfoHeader.biBitCount = 24;
  bitmapInfoHeader.biCompression = 0;
  bitmapInfoHeader.biSizeImage = width * abs(height) * 3;
</code></pre>">  BITMAPFILEHEADER bitmapFileHeader;
  <span class="hljs-built_in">memset</span>(&amp;bitmapFileHeader, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(BITMAPFILEHEADER));
  bitmapFileHeader.bfSize = <span class="hljs-keyword">sizeof</span>(BITMAPFILEHEADER);
  bitmapFileHeader.bfType = <span class="hljs-number">0x4d42</span>;    <span class="hljs-comment">//BM</span>
  bitmapFileHeader.bfOffBits = <span class="hljs-keyword">sizeof</span>(BITMAPFILEHEADER) + <span class="hljs-keyword">sizeof</span>(BITMAPINFOHEADER);

  <span class="hljs-comment">//填充BITMAPINFOHEADER</span>
  BITMAPINFOHEADER bitmapInfoHeader;
  <span class="hljs-built_in">memset</span>(&amp;bitmapInfoHeader, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(BITMAPINFOHEADER));
  bitmapInfoHeader.biSize = <span class="hljs-keyword">sizeof</span>(BITMAPINFOHEADER);
  bitmapInfoHeader.biWidth = width;
  bitmapInfoHeader.biHeight = height;
  bitmapInfoHeader.biPlanes = <span class="hljs-number">1</span>;
  bitmapInfoHeader.biBitCount = <span class="hljs-number">24</span>;
  bitmapInfoHeader.biCompression = <span class="hljs-number">0</span>;
  bitmapInfoHeader.biSizeImage = width * <span class="hljs-built_in">abs</span>(height) * <span class="hljs-number">3</span>;
</code></pre>
</li><li>注意，<code>bmp</code> 文件里的储存格式是 <code>BGR</code>，输出的时候要换一些位置。</li><li>会输出 <code>bmp</code> 后，我们就可以很轻松地实现这个接口了。<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  void screeshot(int width, int height){
      unsigned char *screenData = new unsigned char[width * height * 3];
      glReadPixels(0, 0, width, height, GL_RGB, GL_UNSIGNED_BYTE, screenData);
      WriteBitmapFile(&quot;screenshot.bmp&quot;, width, height, screenData);
      delete []screenData;
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">screeshot</span><span class="hljs-params">(<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span></span>{
      <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *screenData = <span class="hljs-keyword">new</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>[width * height * <span class="hljs-number">3</span>];
      glReadPixels(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height, GL_RGB, GL_UNSIGNED_BYTE, screenData);
      WriteBitmapFile(<span class="hljs-string">"screenshot.bmp"</span>, width, height, screenData);
      <span class="hljs-keyword">delete</span> []screenData;
  }
</code></pre>
</li><li>最后，我们把这个函数关联到主程序的一个按键即可。</li></ul>
</li><li>文字绘制的环境配置<ul>
<li>在 <code>openGL</code> 里绘制文字不是一件简单的事情。</li><li>首先我们要在库文件里加入 <code>freetype</code> 文件夹，在链接文件里加入 <code>freetyped.lib</code>，然后主程序里加入如下代码；<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  #include &amp;lt;ft2build.h&amp;gt;
  #include FT_FREETYPE_H
</code></pre>">  <span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;ft2build.h&gt;</span>
  <span class="hljs-preprocessor">#include FT_FREETYPE_H</span>
</code></pre>
</li><li>在写文字之前，还要专门给文字一个 <code>VAO</code> 和 <code>VBO</code>，并做如下预处理：<pre class="cpp hljs"><code class="Cpp" data-origin="<pre><code class=&quot;Cpp&quot;>  void textInit(unsigned int &amp;amp;VAO, unsigned int &amp;amp;VBO) {
      FT_Library ft;
      if (FT_Init_FreeType(&amp;amp;ft))
          std::cout &amp;lt;&amp;lt; &quot;ERROR::FREETYPE: Could not init FreeType Library&quot; &amp;lt;&amp;lt; std::endl;
      FT_Face face;
      if (FT_New_Face(ft, &quot;cour.ttf&quot;, 0, &amp;amp;face))
          std::cout &amp;lt;&amp;lt; &quot;ERROR::FREETYPE: Failed to load font&quot; &amp;lt;&amp;lt; std::endl;
      FT_Set_Pixel_Sizes(face, 0, 48);
      glPixelStorei(GL_UNPACK_ALIGNMENT, 1);
      for (GLubyte c = 0; c &amp;lt; 128; c++)
      {
          if (FT_Load_Char(face, c, FT_LOAD_RENDER))
          {
              std::cout &amp;lt;&amp;lt; &quot;ERROR::FREETYTPE: Failed to load Glyph&quot; &amp;lt;&amp;lt; std::endl;
              continue;
          }
          GLuint texture;
          glGenTextures(1, &amp;amp;texture);
          glBindTexture(GL_TEXTURE_2D, texture);
          glTexImage2D(
              GL_TEXTURE_2D,
              0,
              GL_RED,
              face-&amp;gt;glyph-&amp;gt;bitmap.width,
              face-&amp;gt;glyph-&amp;gt;bitmap.rows,
              0,
              GL_RED,
              GL_UNSIGNED_BYTE,
              face-&amp;gt;glyph-&amp;gt;bitmap.buffer
          );
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
          Character character = {
              texture,
              glm::ivec2(face-&amp;gt;glyph-&amp;gt;bitmap.width, face-&amp;gt;glyph-&amp;gt;bitmap.rows),
              glm::ivec2(face-&amp;gt;glyph-&amp;gt;bitmap_left, face-&amp;gt;glyph-&amp;gt;bitmap_top),
              face-&amp;gt;glyph-&amp;gt;advance.x
          };
          Characters.insert(std::pair&amp;lt;GLchar, Character&amp;gt;(c, character));
      }
      glBindTexture(GL_TEXTURE_2D, 0);
      FT_Done_Face(face);
      FT_Done_FreeType(ft);
      glGenVertexArrays(1, &amp;amp;VAO);
      glGenBuffers(1, &amp;amp;VBO);
      glBindVertexArray(VAO);
      glBindBuffer(GL_ARRAY_BUFFER, VBO);
      glBufferData(GL_ARRAY_BUFFER, sizeof(GLfloat) * 6 * 4, NULL, GL_DYNAMIC_DRAW);
      glEnableVertexAttribArray(0);
      glVertexAttribPointer(0, 4, GL_FLOAT, GL_FALSE, 4 * sizeof(GLfloat), 0);
      glBindBuffer(GL_ARRAY_BUFFER, 0);
      glBindVertexArray(0);
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">textInit</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;VAO, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> &amp;VBO)</span> </span>{
      FT_Library ft;
      <span class="hljs-keyword">if</span> (FT_Init_FreeType(&amp;ft))
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"ERROR::FREETYPE: Could not init FreeType Library"</span> &lt;&lt; <span class="hljs-built_in">std</span>::endl;
      FT_Face face;
      <span class="hljs-keyword">if</span> (FT_New_Face(ft, <span class="hljs-string">"cour.ttf"</span>, <span class="hljs-number">0</span>, &amp;face))
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"ERROR::FREETYPE: Failed to load font"</span> &lt;&lt; <span class="hljs-built_in">std</span>::endl;
      FT_Set_Pixel_Sizes(face, <span class="hljs-number">0</span>, <span class="hljs-number">48</span>);
      glPixelStorei(GL_UNPACK_ALIGNMENT, <span class="hljs-number">1</span>);
      <span class="hljs-keyword">for</span> (GLubyte c = <span class="hljs-number">0</span>; c &lt; <span class="hljs-number">128</span>; c++)
      {
          <span class="hljs-keyword">if</span> (FT_Load_Char(face, c, FT_LOAD_RENDER))
          {
              <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"ERROR::FREETYTPE: Failed to load Glyph"</span> &lt;&lt; <span class="hljs-built_in">std</span>::endl;
              <span class="hljs-keyword">continue</span>;
          }
          GLuint texture;
          glGenTextures(<span class="hljs-number">1</span>, &amp;texture);
          glBindTexture(GL_TEXTURE_2D, texture);
          glTexImage2D(
              GL_TEXTURE_2D,
              <span class="hljs-number">0</span>,
              GL_RED,
              face-&gt;glyph-&gt;bitmap.width,
              face-&gt;glyph-&gt;bitmap.rows,
              <span class="hljs-number">0</span>,
              GL_RED,
              GL_UNSIGNED_BYTE,
              face-&gt;glyph-&gt;bitmap.buffer
          );
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
          Character character = {
              texture,
              glm::ivec2(face-&gt;glyph-&gt;bitmap.width, face-&gt;glyph-&gt;bitmap.rows),
              glm::ivec2(face-&gt;glyph-&gt;bitmap_left, face-&gt;glyph-&gt;bitmap_top),
              face-&gt;glyph-&gt;advance.x
          };
          Characters.insert(<span class="hljs-built_in">std</span>::pair&lt;GLchar, Character&gt;(c, character));
      }
      glBindTexture(GL_TEXTURE_2D, <span class="hljs-number">0</span>);
      FT_Done_Face(face);
      FT_Done_FreeType(ft);
      glGenVertexArrays(<span class="hljs-number">1</span>, &amp;VAO);
      glGenBuffers(<span class="hljs-number">1</span>, &amp;VBO);
      glBindVertexArray(VAO);
      glBindBuffer(GL_ARRAY_BUFFER, VBO);
      glBufferData(GL_ARRAY_BUFFER, <span class="hljs-keyword">sizeof</span>(GLfloat) * <span class="hljs-number">6</span> * <span class="hljs-number">4</span>, NULL, GL_DYNAMIC_DRAW);
      glEnableVertexAttribArray(<span class="hljs-number">0</span>);
      glVertexAttribPointer(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">4</span> * <span class="hljs-keyword">sizeof</span>(GLfloat), <span class="hljs-number">0</span>);
      glBindBuffer(GL_ARRAY_BUFFER, <span class="hljs-number">0</span>);
      glBindVertexArray(<span class="hljs-number">0</span>);
  }
</code></pre>
</li></ul>
</li><li><p>文字的渲染</p>
<ul>
<li>为了增强可拓展性，我们要对外提供这么一个接口：<code>RenderText(Shader &amp;shader, unsigned int &amp;VAO, unsigned int &amp;VBO, std::string text, GLfloat x, GLfloat y, GLfloat scale, glm::vec3 color)</code>。<code>text</code> 表示渲染的文字内容，<code>x,y,scale</code> 表示字体的位置和大小，<code>color</code> 表示字体的颜色。</li><li>渲染的时候，注意还要打开开关：<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  glEnable(GL_CULL_FACE);
  glEnable(GL_BLEND);
  glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
</code></pre>">  glEnable(GL_CULL_FACE);
  glEnable(GL_BLEND);
  glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
</code></pre>
</li><li>大概是类似于线框模式的渲染，否则会渲染出一个一个方形。</li><li><p>效果如下：</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/words.png" alt="" title="markdown" style="width:600px"></p>
</li></ul>
</li></ul><h4 id="8.-光照明实时阴影的实现"><a name="8.-光照明实时阴影的实现" href="#8.-光照明实时阴影的实现"></a>8. 光照明实时阴影的实现</h4><ul>
<li><p><strong>实时阴影是本作品的一大亮点</strong>。实现实时阴影的过程也是程序编写中遇到曲折比较多的一个部分。在制作阴影效果时，我们使用的是阴影贴图技术。</p>
<ul>
<li><p>生成阴影贴图需要生成新的帧缓冲。区别于显示在屏幕上的缓冲，我们需要在光源的位置观察各对象，并以此计算各片元的深度，以生成阴影贴图。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>    float lightDistance = length(FragPos.xyz - lightPos);
    // map to [0;1] range by dividing by far_plane
    lightDistance = lightDistance / far_plane;
    // write this as modified depth
    gl_FragDepth = lightDistance;
</code></pre>">    <span class="hljs-keyword">float</span> lightDistance = length(FragPos.xyz - lightPos);
    <span class="hljs-comment">// map to [0;1] range by dividing by far_plane</span>
    lightDistance = lightDistance / far_plane;
    <span class="hljs-comment">// write this as modified depth</span>
    gl_FragDepth = lightDistance;
</code></pre>
</li><li><p>生成的阴影贴图大致是这个效果：</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/shadow.JPG" alt="" title="markdown" style="width:600px"></p>
</li><li><p>通过比较当前片元的深度是否在可观察平面的“后面”，来应用阴影贴图。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  float shadow = shadows ? ShadowCalculation(fs_in.FragPos) : 0.0;
</code></pre>">  <span class="hljs-keyword">float</span> shadow = shadows ? ShadowCalculation(fs_in.FragPos) : <span class="hljs-number">0.0</span>;
</code></pre>
</li><li><p>与平行光阴影不同的是，点阴影需要向六个方向分别计算深度（一个视界内不可能看到后面的物体）。这部分可以在几何着色器中完成。结束后，六个面的深度贴图都会加载到帧缓冲上。</p>
</li></ul>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>    for(int face = 0; face &amp;lt; 6; ++face)
    {
        gl_Layer = face; // built-in variable that specifies to which face we render.
        for(int i = 0; i &amp;lt; 3; ++i) // for each triangle's vertices
        {
            FragPos = gl_in[i].gl_Position;
            gl_Position = shadowMatrices[face] * FragPos;
            EmitVertex();
        }
        EndPrimitive();
    }
</code></pre>">    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> face = <span class="hljs-number">0</span>; face &lt; <span class="hljs-number">6</span>; ++face)
    {
        gl_Layer = face; <span class="hljs-comment">// built-in variable that specifies to which face we render.</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) <span class="hljs-comment">// for each triangle's vertices</span>
        {
            FragPos = gl_in[i].gl_Position;
            gl_Position = shadowMatrices[face] * FragPos;
            EmitVertex();
        }
        EndPrimitive();
    }
</code></pre>
</li></ul><h4 id="9.-场景实时碰撞检测实现方法"><a name="9.-场景实时碰撞检测实现方法" href="#9.-场景实时碰撞检测实现方法"></a>9. 场景实时碰撞检测实现方法</h4><ul>
<li><p><strong>场景实时碰撞检测是我们的又一大亮点。</strong>我们实现了子弹和玩家与所有可破坏场景内物体的碰撞。</p>
</li><li><p>在进行碰撞检测时我们使用了如下逻辑：</p>
<ul>
<li>先沿当前方向尝试做一帧的运动</li><li><p>得到从当前位置到下一位置的向量（尽管这个运动可能是一个斜抛运动，但我们可以用一个直线运动来近似）</p>
</li><li><p>用该有向线段与模型面先判断是否有交</p>
<ul>
<li><p>若没有交肯定不会与该面碰撞</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  // ball
  // here we consider all object has its shape
  pair&amp;lt;double, Point3D&amp;gt; Ball::collide(const Point3D &amp;amp;A, const Point3D &amp;amp;C, const Point3D &amp;amp;B) const {//this is reversed for some reason...
      double projdis = pointtoplanedistance(posi, A, B, C);
      if (projdis &amp;lt; 0.01)return make_pair(1, velo);
      if (pointtoplanedistance(posi + velo, A, B, C) &amp;gt; 0.25)return make_pair(1, velo);
      Point3D temp = ((C - A) * (B - A)).resize(1);
      if (sgn(pointtoplanedistance(posi, A, B, posi + velo)) &amp;lt; 0)return make_pair(1, velo);
      if (sgn(pointtoplanedistance(posi, B, C, posi + velo)) &amp;lt; 0)return make_pair(1, velo);
      if (sgn(pointtoplanedistance(posi, C, A, posi + velo)) &amp;lt; 0)return make_pair(1, velo);
      return make_pair((projdis - 0.25) / -(velo%temp), velo - temp.resize(velo%temp * 2));
  }

  // camera
  pair&amp;lt;bool, double&amp;gt; getDisToFace(glm::vec3 position, glm::vec3 velo, Point3D a, Point3D b, Point3D c)
  {
      Ball tmp = Ball(Point3D(position), Point3D(velo));
      pair&amp;lt;double, Point3D&amp;gt; r = tmp.collide(a, b, c);
      bool flag = sgn(r.first - 1) &amp;lt; 0;
      return make_pair(flag, r.first);
  }
</code></pre>">  <span class="hljs-comment">// ball</span>
  <span class="hljs-comment">// here we consider all object has its shape</span>
  pair&lt;<span class="hljs-keyword">double</span>, Point3D&gt; Ball::collide(<span class="hljs-keyword">const</span> Point3D &amp;A, <span class="hljs-keyword">const</span> Point3D &amp;C, <span class="hljs-keyword">const</span> Point3D &amp;B) <span class="hljs-keyword">const</span> {<span class="hljs-comment">//this is reversed for some reason...</span>
      <span class="hljs-keyword">double</span> projdis = pointtoplanedistance(posi, A, B, C);
      <span class="hljs-keyword">if</span> (projdis &lt; <span class="hljs-number">0.01</span>)<span class="hljs-keyword">return</span> make_pair(<span class="hljs-number">1</span>, velo);
      <span class="hljs-keyword">if</span> (pointtoplanedistance(posi + velo, A, B, C) &gt; <span class="hljs-number">0.25</span>)<span class="hljs-keyword">return</span> make_pair(<span class="hljs-number">1</span>, velo);
      Point3D temp = ((C - A) * (B - A)).resize(<span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (sgn(pointtoplanedistance(posi, A, B, posi + velo)) &lt; <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> make_pair(<span class="hljs-number">1</span>, velo);
      <span class="hljs-keyword">if</span> (sgn(pointtoplanedistance(posi, B, C, posi + velo)) &lt; <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> make_pair(<span class="hljs-number">1</span>, velo);
      <span class="hljs-keyword">if</span> (sgn(pointtoplanedistance(posi, C, A, posi + velo)) &lt; <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> make_pair(<span class="hljs-number">1</span>, velo);
      <span class="hljs-keyword">return</span> make_pair((projdis - <span class="hljs-number">0.25</span>) / -(velo%temp), velo - temp.resize(velo%temp * <span class="hljs-number">2</span>));
  }

  <span class="hljs-comment">// camera</span>
  pair&lt;<span class="hljs-keyword">bool</span>, <span class="hljs-keyword">double</span>&gt; getDisToFace(glm::vec3 position, glm::vec3 velo, Point3D a, Point3D b, Point3D c)
  {
      Ball tmp = Ball(Point3D(position), Point3D(velo));
      pair&lt;<span class="hljs-keyword">double</span>, Point3D&gt; r = tmp.collide(a, b, c);
      <span class="hljs-keyword">bool</span> flag = sgn(r.first - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>;
      <span class="hljs-keyword">return</span> make_pair(flag, r.first);
  }
</code></pre>
</li><li><p>若有交，则计算出从当前位置到该面沿移动方向的距离，存入vector</p>
</li></ul>
</li><li><p>在所有有交的面中，选择距离最短的一个面，这个面必然就是碰撞发生的面。</p>
</li><li><p>这里以与墙的碰撞为例</p>
</li></ul>
</li></ul><pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>    for (Wall *pwall : WallManager) {
        int siz = pwall-&amp;gt;allface.size();

        vector&amp;lt; pair&amp;lt;double, Point3D&amp;gt; &amp;gt; collisions;
        for (int i = 0; i &amp;lt; siz; i += 4) {
            Point3D n;
            pair&amp;lt;bool, double&amp;gt; res = getDisToFace(last, velo_vec, pwall-&amp;gt;allface[i], pwall-&amp;gt;allface[i + 1], pwall-&amp;gt;allface[i + 2]);
            n = (pwall-&amp;gt;allface[i + 1] - pwall-&amp;gt;allface[i]) * (pwall-&amp;gt;allface[i + 2] - pwall-&amp;gt;allface[i]);
            if (res.first) collisions.push_back(make_pair(res.second, n));

            res = getDisToFace(last, velo_vec, pwall-&amp;gt;allface[i + 2], pwall-&amp;gt;allface[i + 3], pwall-&amp;gt;allface[i]);
            n = (pwall-&amp;gt;allface[i + 3] - pwall-&amp;gt;allface[i + 2]) * (pwall-&amp;gt;allface[i] - pwall-&amp;gt;allface[i + 2]);
            if (res.first) collisions.push_back(make_pair(res.second, n));
        }
        if (collisions.size() &amp;gt; 0)
        {
            sort(collisions.begin(), collisions.end(), tcmp);
            return make_pair(false, collisions[0].second);
        }
    }
</code></pre>">    <span class="hljs-keyword">for</span> (Wall *pwall : WallManager) {
        <span class="hljs-keyword">int</span> siz = pwall-&gt;allface.size();

        <span class="hljs-built_in">vector</span>&lt; pair&lt;<span class="hljs-keyword">double</span>, Point3D&gt; &gt; collisions;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; siz; i += <span class="hljs-number">4</span>) {
            Point3D n;
            pair&lt;<span class="hljs-keyword">bool</span>, <span class="hljs-keyword">double</span>&gt; res = getDisToFace(last, velo_vec, pwall-&gt;allface[i], pwall-&gt;allface[i + <span class="hljs-number">1</span>], pwall-&gt;allface[i + <span class="hljs-number">2</span>]);
            n = (pwall-&gt;allface[i + <span class="hljs-number">1</span>] - pwall-&gt;allface[i]) * (pwall-&gt;allface[i + <span class="hljs-number">2</span>] - pwall-&gt;allface[i]);
            <span class="hljs-keyword">if</span> (res.first) collisions.push_back(make_pair(res.second, n));

            res = getDisToFace(last, velo_vec, pwall-&gt;allface[i + <span class="hljs-number">2</span>], pwall-&gt;allface[i + <span class="hljs-number">3</span>], pwall-&gt;allface[i]);
            n = (pwall-&gt;allface[i + <span class="hljs-number">3</span>] - pwall-&gt;allface[i + <span class="hljs-number">2</span>]) * (pwall-&gt;allface[i] - pwall-&gt;allface[i + <span class="hljs-number">2</span>]);
            <span class="hljs-keyword">if</span> (res.first) collisions.push_back(make_pair(res.second, n));
        }
        <span class="hljs-keyword">if</span> (collisions.size() &gt; <span class="hljs-number">0</span>)
        {
            sort(collisions.begin(), collisions.end(), tcmp);
            <span class="hljs-keyword">return</span> make_pair(<span class="hljs-keyword">false</span>, collisions[<span class="hljs-number">0</span>].second);
        }
    }
</code></pre><ul>
<li><p>如此我们就完成了碰撞是否发生的检测，检测过后需要实现反弹的效果，这里我们在输出碰撞面的同时，就可以通过面上的点，得到他的法向量<span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-47-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-553" style="width: 1.283em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.038em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.769em 1000em 2.361em -0.436em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-554"><span class="munderover" id="MathJax-Span-555"><span style="display: inline-block; position: relative; width: 1em; height: 0px;"><span style="position: absolute; clip: rect(1.853em 1000em 2.634em -0.471em); top: -2.459em; left: 0.199em;"><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(1.903em 1000em 2.853em -0.436em); top: -3.32em; left: 0em;"><span class="mo" id="MathJax-Span-557" style=""><span style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.675em; vertical-align: -0.08em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-47">\overrightarrow{n}</script></span> 。假定当前速度向量是<span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-48-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-558" style="width: 0.683em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.546em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.244em 1000em 2.361em -0.91em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-559"><span class="texatom" id="MathJax-Span-560"><span class="mrow" id="MathJax-Span-561"><span class="munderover" id="MathJax-Span-562"><span style="display: inline-block; position: relative; width: 0.495em; height: 0px;"><span style="position: absolute; clip: rect(1.852em 1000em 2.634em -0.471em); top: -2.459em; left: 0em;"><span class="mi" id="MathJax-Span-563" style="font-family: MathJax_Math; font-style: italic;">v</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; top: -4.053em; left: 0.053em;"><span style="height: 0em; vertical-align: 0em; width: 0.471em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-564" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.273em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.989em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.095em; vertical-align: -0.08em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-48">\vec{v}</script></span>，则碰撞后满足：$\overrightarrow{v’}=\vec{v}-2\frac{\vec{v}\cdot \vec{n}}{|\vec{n}|}\hat{n}$</p>
</li><li><p>在完成碰撞后，应该沿新的速度向量防线再做一次运动。</p>
</li></ul><pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>    Point3D subsao(Point3D vx, Point3D vo)
    {
        double len = (vx % vo) / vo.length();
        Point3D diao = vo * (len / vo.length());
        return vx - diao * 2;
    }

    pair&amp;lt;bool, Point3D&amp;gt; ret = CheckValiPosi(last);
    if (ret.first == false)
    {
        if (sgn((ret.second - Point3D(0, 0, 0)).length())&amp;gt;0)
        {
            Point3D newv = subsao(Point3D(velocity), ret.second);
            bool fg = Position.y &amp;lt;= -0.2;
            velocity.x = newv.x;
            velocity.y = newv.y;
            velocity.z = newv.z;
            Position += k * velocity;
            if (fg)velocity = glm::vec3(0);
        }
        else
        {
            Position = last;
        }
    }
</code></pre>">    <span class="hljs-function">Point3D <span class="hljs-title">subsao</span><span class="hljs-params">(Point3D vx, Point3D vo)</span>
    </span>{
        <span class="hljs-keyword">double</span> len = (vx % vo) / vo.length();
        Point3D diao = vo * (len / vo.length());
        <span class="hljs-keyword">return</span> vx - diao * <span class="hljs-number">2</span>;
    }

    pair&lt;<span class="hljs-keyword">bool</span>, Point3D&gt; ret = CheckValiPosi(last);
    <span class="hljs-keyword">if</span> (ret.first == <span class="hljs-keyword">false</span>)
    {
        <span class="hljs-keyword">if</span> (sgn((ret.second - Point3D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)).length())&gt;<span class="hljs-number">0</span>)
        {
            Point3D newv = subsao(Point3D(velocity), ret.second);
            <span class="hljs-keyword">bool</span> fg = Position.y &lt;= -<span class="hljs-number">0.2</span>;
            velocity.x = newv.x;
            velocity.y = newv.y;
            velocity.z = newv.z;
            Position += k * velocity;
            <span class="hljs-keyword">if</span> (fg)velocity = glm::vec3(<span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">else</span>
        {
            Position = last;
        }
    }
</code></pre><h4 id="10.-视口中心点对应方块与墙破坏的确定方法"><a name="10.-视口中心点对应方块与墙破坏的确定方法" href="#10.-视口中心点对应方块与墙破坏的确定方法"></a>10. 视口中心点对应方块与墙破坏的确定方法</h4><ul>
<li><p>确定视口中心点对应方块</p>
<ul>
<li>首先确定每个墙与视线射线相交的方块，然后取出其中最近的方块。</li><li>最近的方块也不够近时会判定没有破坏。<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  double FlipFace(bool modified) {
      double mi = inf;
      if (endgame)return mi;
      pair&amp;lt;Wall*, pair&amp;lt;int, int&amp;gt;&amp;gt; ret = make_pair(nullptr,make_pair(-1, -1));
      for (Wall *pwall : WallManager) {
          pair&amp;lt;double, pair&amp;lt;Wall*, pair&amp;lt;int, int&amp;gt;&amp;gt;&amp;gt;temp = pwall-&amp;gt;clicked(
              Point3D(camera.Position),
              Point3D(camera.Front)
          );
          if (temp.first &amp;lt; mi) {
              mi = temp.first;
              ret = temp.second;
          }
      }
      if (ret.first != nullptr &amp;amp;&amp;amp; mi &amp;lt; clickdist &amp;amp;&amp;amp; modified) {
          ret.first-&amp;gt;bkdown(ret.second.first, ret.second.second), puts(&quot;Modified&quot;);
      }
      return mi;
  }
</code></pre>">  <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">FlipFace</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> modified)</span> </span>{
      <span class="hljs-keyword">double</span> mi = inf;
      <span class="hljs-keyword">if</span> (endgame)<span class="hljs-keyword">return</span> mi;
      pair&lt;Wall*, pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt; ret = make_pair(<span class="hljs-keyword">nullptr</span>,make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>));
      <span class="hljs-keyword">for</span> (Wall *pwall : WallManager) {
          pair&lt;<span class="hljs-keyword">double</span>, pair&lt;Wall*, pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt;&gt;temp = pwall-&gt;clicked(
              Point3D(camera.Position),
              Point3D(camera.Front)
          );
          <span class="hljs-keyword">if</span> (temp.first &lt; mi) {
              mi = temp.first;
              ret = temp.second;
          }
      }
      <span class="hljs-keyword">if</span> (ret.first != <span class="hljs-keyword">nullptr</span> &amp;&amp; mi &lt; clickdist &amp;&amp; modified) {
          ret.first-&gt;bkdown(ret.second.first, ret.second.second), <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Modified"</span>);
      }
      <span class="hljs-keyword">return</span> mi;
  }
</code></pre>
</li><li><p>墙与视线交点是射线与平面相交问题：</p>
<ul>
<li><p>取点在平面上投影 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-49-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-565" style="width: 1.283em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.038em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.769em 1000em 2.544em -0.436em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-566"><span class="munderover" id="MathJax-Span-567"><span style="display: inline-block; position: relative; width: 1em; height: 0px;"><span style="position: absolute; clip: rect(1.853em 1000em 2.817em -0.531em); top: -2.459em; left: 0.227em;"><span class="mi" id="MathJax-Span-568" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(1.903em 1000em 2.853em -0.436em); top: -3.32em; left: 0em;"><span class="mo" id="MathJax-Span-569" style=""><span style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.899em; vertical-align: -0.303em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-49">\overrightarrow p</script></span>，方向向量投影 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-50-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-570" style="width: 1.283em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.038em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.768em 1000em 2.361em -0.436em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-571"><span class="munderover" id="MathJax-Span-572"><span style="display: inline-block; position: relative; width: 1em; height: 0px;"><span style="position: absolute; clip: rect(1.852em 1000em 2.634em -0.471em); top: -2.459em; left: 0.254em;"><span class="mi" id="MathJax-Span-573" style="font-family: MathJax_Math; font-style: italic;">v</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(1.903em 1000em 2.853em -0.436em); top: -3.321em; left: 0em;"><span class="mo" id="MathJax-Span-574" style=""><span style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.677em; vertical-align: -0.08em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-50">\overrightarrow v</script></span>，点到平面距离 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-51-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-575" style="width: 0.683em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.546em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.601em 1000em 2.633em -0.459em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-576"><span class="mi" id="MathJax-Span-577" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.992em; vertical-align: -0.079em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-51">d</script></span>，方向向量在平面法向量方向上长度 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-52-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-578" style="width: 0.417em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.328em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.601em 1000em 2.634em -0.454em); top: -2.459em; left: 0em;"><span class="mrow" id="MathJax-Span-579"><span class="mi" id="MathJax-Span-580" style="font-family: MathJax_Math; font-style: italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.993em; vertical-align: -0.08em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-52">l</script></span>，有交点为<span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-53-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-581" style="width: 6.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.519em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.26em 1000em 3.092em -0.436em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-582"><span class="munderover" id="MathJax-Span-583"><span style="display: inline-block; position: relative; width: 1em; height: 0px;"><span style="position: absolute; clip: rect(1.853em 1000em 2.817em -0.531em); top: -2.459em; left: 0.227em;"><span class="mi" id="MathJax-Span-584" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(1.903em 1000em 2.853em -0.436em); top: -3.32em; left: 0em;"><span class="mo" id="MathJax-Span-585" style=""><span style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-586" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="munderover" id="MathJax-Span-587" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1em; height: 0px;"><span style="position: absolute; clip: rect(1.852em 1000em 2.634em -0.471em); top: -2.459em; left: 0.254em;"><span class="mi" id="MathJax-Span-588" style="font-family: MathJax_Math; font-style: italic;">v</span><span style="display: inline-block; width: 0px; height: 2.459em;"></span></span><span style="position: absolute; clip: rect(1.903em 1000em 2.853em -0.436em); top: -3.321em; left: 0em;"><span class="mo" id="MathJax-Span-589" style=""><span style="font-family: MathJax_Main;">→</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span></span><span class="mo" id="MathJax-Span-590" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="mi" id="MathJax-Span-591" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-592"><span class="mrow" id="MathJax-Span-593"><span class="mo" id="MathJax-Span-594" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-595" style="font-family: MathJax_Math; font-style: italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.968em; vertical-align: -0.372em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-53">\overrightarrow p + \overrightarrow v * d / l</script></span>，注意判定 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-54-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-596" style="width: 2.617em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.131em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.82em 1000em 2.98em -0.454em); top: -2.678em; left: 0em;"><span class="mrow" id="MathJax-Span-597"><span class="mi" id="MathJax-Span-598" style="font-family: MathJax_Math; font-style: italic;">l</span><span class="mo" id="MathJax-Span-599" style="font-family: MathJax_Main; padding-left: 0.278em;">≤</span><span class="mn" id="MathJax-Span-600" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.678em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.148em; vertical-align: -0.235em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-54">l \leq 0</script></span> 的情况。</p>
<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>pair&amp;lt;double, pair&amp;lt;Wall*, pair&amp;lt;int, int&amp;gt;&amp;gt;&amp;gt; Wall::clicked(const Point3D &amp;amp;circenter, const Point3D &amp;amp;direction) {//returns inf when not clicked
      //assert(sgn(direction.length())!=0);
      //proj to 2D
  Point2D projcenter(
      (circenter - center) % (px - center) / xlength,
      (circenter - center) % (py - center) / ylength
  );
  double projdis = pointtoplanedistance(circenter, center, px, py);
  Point3D temp = (px - center) * (py - center) / xlength / ylength;
  double clickdis = (direction % temp) / direction.length();//direction.length() == 1? what?
  if (projdis &amp;lt; 0) {
      projdis = -projdis - zlength;
      if (projdis &amp;lt; 0) {
          projdis = 0;
          return make_pair(inf, make_pair(nullptr, make_pair(-1, -1)));//Walls can not be clicked when you are inside of it; Should be handled separately?
      }
      if (sgn(clickdis) &amp;gt;= 0)return make_pair(inf, make_pair(nullptr, make_pair(-1, -1)));
      clickdis = -clickdis;
  }
  else {
      if (sgn(clickdis) &amp;lt;= 0)return make_pair(inf, make_pair(nullptr, make_pair(-1, -1)));
  }
  //intersection
  Point2D intersection(
      direction % (px - center) / xlength / direction.length() * projdis / clickdis,//direction.length() == 1?
      direction % (py - center) / ylength / direction.length() * projdis / clickdis
  );
  intersection = intersection + projcenter;
  if (intersection.x &amp;lt; 0 || intersection.x &amp;gt;= xlength || intersection.y &amp;lt; 0 || intersection.y &amp;gt;= ylength)
      return make_pair(inf, make_pair(nullptr, make_pair(-1, -1)));

  if (face[trunc(intersection.x / (xlength / accx))][trunc(intersection.y / (ylength / accy))].live == 0)
      return make_pair(inf, make_pair(nullptr, make_pair(-1, -1)));
  return make_pair(
      projdis / clickdis,
      make_pair(
          this,
          make_pair(
              (int)trunc(intersection.x / (xlength / accx)),
              (int)trunc(intersection.y / (ylength / accy))
          )
      )
  );
}
</code></pre>">pair&lt;<span class="hljs-keyword">double</span>, pair&lt;Wall*, pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt;&gt; Wall::clicked(<span class="hljs-keyword">const</span> Point3D &amp;circenter, <span class="hljs-keyword">const</span> Point3D &amp;direction) {<span class="hljs-comment">//returns inf when not clicked</span>
      <span class="hljs-comment">//assert(sgn(direction.length())!=0);</span>
      <span class="hljs-comment">//proj to 2D</span>
  <span class="hljs-function">Point2D <span class="hljs-title">projcenter</span><span class="hljs-params">(
      (circenter - center)</span> % <span class="hljs-params">(px - center)</span> / xlength,
      <span class="hljs-params">(circenter - center)</span> % <span class="hljs-params">(py - center)</span> / ylength
  )</span>;
  <span class="hljs-keyword">double</span> projdis = pointtoplanedistance(circenter, center, px, py);
  Point3D temp = (px - center) * (py - center) / xlength / ylength;
  <span class="hljs-keyword">double</span> clickdis = (direction % temp) / direction.length();<span class="hljs-comment">//direction.length() == 1? what?</span>
  <span class="hljs-keyword">if</span> (projdis &lt; <span class="hljs-number">0</span>) {
      projdis = -projdis - zlength;
      <span class="hljs-keyword">if</span> (projdis &lt; <span class="hljs-number">0</span>) {
          projdis = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">return</span> make_pair(inf, make_pair(<span class="hljs-keyword">nullptr</span>, make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)));<span class="hljs-comment">//Walls can not be clicked when you are inside of it; Should be handled separately?</span>
      }
      <span class="hljs-keyword">if</span> (sgn(clickdis) &gt;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> make_pair(inf, make_pair(<span class="hljs-keyword">nullptr</span>, make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)));
      clickdis = -clickdis;
  }
  <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (sgn(clickdis) &lt;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> make_pair(inf, make_pair(<span class="hljs-keyword">nullptr</span>, make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)));
  }
  <span class="hljs-comment">//intersection</span>
  <span class="hljs-function">Point2D <span class="hljs-title">intersection</span><span class="hljs-params">(
      direction % (px - center)</span> / xlength / direction.<span class="hljs-title">length</span><span class="hljs-params">()</span> * projdis / clickdis,<span class="hljs-comment">//direction.length() == 1?</span>
      direction % <span class="hljs-params">(py - center)</span> / ylength / direction.<span class="hljs-title">length</span><span class="hljs-params">()</span> * projdis / clickdis
  )</span>;
  intersection = intersection + projcenter;
  <span class="hljs-keyword">if</span> (intersection.x &lt; <span class="hljs-number">0</span> || intersection.x &gt;= xlength || intersection.y &lt; <span class="hljs-number">0</span> || intersection.y &gt;= ylength)
      <span class="hljs-keyword">return</span> make_pair(inf, make_pair(<span class="hljs-keyword">nullptr</span>, make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)));

  <span class="hljs-keyword">if</span> (face[trunc(intersection.x / (xlength / accx))][trunc(intersection.y / (ylength / accy))].live == <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> make_pair(inf, make_pair(<span class="hljs-keyword">nullptr</span>, make_pair(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)));
  <span class="hljs-keyword">return</span> make_pair(
      projdis / clickdis,
      make_pair(
          <span class="hljs-keyword">this</span>,
          make_pair(
              (<span class="hljs-keyword">int</span>)trunc(intersection.x / (xlength / accx)),
              (<span class="hljs-keyword">int</span>)trunc(intersection.y / (ylength / accy))
          )
      )
  );
}
</code></pre>
</li></ul>
</li><li><p>最终效果</p>
<ul>
<li><p>为了便于理解，我们在交点位置显示了一个手雷，嵌在墙的内部。</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/center.png" alt="" title="markdown" style="width:600px"></p>
</li></ul>
</li></ul>
</li><li><p>墙破坏</p>
<ul>
<li>墙在被右键点击时，会被随机破坏。</li><li>破坏的形式是先保证中心以及上下左右四个位置被破坏，然后对角的四个位置每个都有 <span><span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-55-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-601" style="width: 0.95em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.765em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.138em 1000em 2.748em -0.492em); top: -2.186em; left: 0em;"><span class="mrow" id="MathJax-Span-602"><span class="mfrac" id="MathJax-Span-603"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.715em 1000em 2.514em -0.433em); top: -2.762em; left: 50%; margin-left: -0.191em;"><span class="mn" id="MathJax-Span-604" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 2.35em;"></span></span><span style="position: absolute; clip: rect(1.716em 1000em 2.529em -0.462em); top: -1.967em; left: 50%; margin-left: -0.191em;"><span class="mn" id="MathJax-Span-605" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 2.35em;"></span></span><span style="position: absolute; clip: rect(0.861em 1000em 1.257em -0.492em); top: -1.313em; left: 0em;"><span style="border-left-width: 0.503em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.093em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.186em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.697em; vertical-align: -0.553em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-55">\frac{1}{3}</script></span> 的概率被破坏。<pre class="cpp hljs"><code class="cpp" data-origin="<pre><code class=&quot;cpp&quot;>  void Wall::filp(int x, int y) {
      if (x &amp;lt; 0 || x &amp;gt;= accx || y &amp;lt; 0 || y &amp;gt;= accy) return;
      face[x][y].live = 0;
  }
  void Wall::bkdown(int x, int y) {
      filp(x, y);
      filp(x - 1, y);filp(x + 1, y);filp(x, y - 1);filp(x, y + 1);
      if (rand() % 3 == 0)filp(x - 1, y - 1);
      if (rand() % 3 == 0)filp(x + 1, y - 1);
      if (rand() % 3 == 0)filp(x - 1, y + 1);
      if (rand() % 3 == 0)filp(x + 1, y + 1);
  }
</code></pre>">  <span class="hljs-keyword">void</span> Wall::filp(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y) {
      <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || x &gt;= accx || y &lt; <span class="hljs-number">0</span> || y &gt;= accy) <span class="hljs-keyword">return</span>;
      face[x][y].live = <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">void</span> Wall::bkdown(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y) {
      filp(x, y);
      filp(x - <span class="hljs-number">1</span>, y);filp(x + <span class="hljs-number">1</span>, y);filp(x, y - <span class="hljs-number">1</span>);filp(x, y + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (rand() % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)filp(x - <span class="hljs-number">1</span>, y - <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (rand() % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)filp(x + <span class="hljs-number">1</span>, y - <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (rand() % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)filp(x - <span class="hljs-number">1</span>, y + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (rand() % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)filp(x + <span class="hljs-number">1</span>, y + <span class="hljs-number">1</span>);
  }
</code></pre>
</li><li><p>最终效果</p>
<ul>
<li><p>已经被破坏的墙不能被点击，并且墙不会掉落，造成一种类似 Minecraft 的效果。</p>
<p><img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/breakwall.png" alt="" title="markdown" style="width:600px"></p>
</li></ul>
</li></ul>
</li></ul><h2 id="三、成果展示"><a name="三、成果展示" href="#三、成果展示"></a>三、成果展示</h2><ul>
<li><p>游戏界面</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/screenshot0.bmp" alt="" title="markdown" style="width:600px"></p>
</li><li><p>墙破坏和跳跃</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/screenshot1.bmp" alt="" title="markdown" style="width:600px"></p>
</li><li><p>子弹和阴影</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/screenshot2.bmp" alt="" title="markdown" style="width:600px"></p>
</li><li><p>子弹放大图</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/bullet.png" alt="" title="markdown" style="width:600px"></p>
</li><li><p>月亮和天空盒</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/screenshot3.bmp" alt="" title="markdown" style="width:600px"></p>
</li><li><p>墙破坏的阴影</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/screenshot4.bmp" alt="" title="markdown" style="width:600px"></p>
</li><li><p>南瓜被击中的效果</p>
<p>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/shot1.png" alt="" title="markdown" style="width:600px"><br>  <img src="file:///E:/ZJU%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%B4%BB/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%A4%A7%E7%A8%8B/%E6%9C%80%E7%BB%88%E6%8A%A5%E5%91%8A/shot0.png" alt="" title="markdown" style="width:600px"></p>
</li></ul>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
